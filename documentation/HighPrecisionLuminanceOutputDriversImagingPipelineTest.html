<h2 id="psychtoolbox-psychtests">[[Psychtoolbox]] › [[PsychTests]]</h2>
<p><a href="HighPrecisionLuminanceOutputDriversImagingPipelineTest" class="uri">HighPrecisionLuminanceOutputDriversImagingPipelineTest</a>(whichDriver, [whichScreen][,plotdiffs=0][, forcesuccess=0])</p>
<p>Tests correct function of a variety of high precision luminance output<br />
device drivers (so called “output formatters”) with imaging pipeline.</p>
<p>This test script needs to be run once after each graphics card or<br />
graphics driver or Psychtoolbox upgrade, or after any other major change<br />
in system configuration and display settings.</p>
<p>This test verifies that the Psychtoolbox image processing pipeline is<br />
capable to correctly convert a high dynamic range / high bit precision<br />
luminance image into a output format suitable for driving one of the<br />
supported high precision luminance output devices, e.g., different Pelli,<br />
Zhang, Watson style video attenuators, Xiangru Li et al. <a href="VideoSwitchers" class="uri">VideoSwitchers</a>,<br />
Pseudo-Gray output formatters, etc.</p>
<p>It does so by generating a test stimulus, converting it into a properly<br />
formatted image via the “known good” Matlab reference implementation of<br />
an output driver, then again via the use of the imaging pipeline. Then<br />
it reads back and compares the conversion results of both to verify that<br />
the imaging pipeline produces exactly the same results as the Matlab<br />
routines.</p>
<p>If the results are the same, it will write some info file to the<br />
filesystem to confirm this test was successfully run, otherwise it will<br />
fail with a description of the discrepancy. In case of failure, fast<br />
stimulus conversion will not work via the imaging pipeline.</p>
<p>The required parameter ‘whichDriver’ defines the type of output driver to<br />
test. It can be any of the following:</p>
<p>* ‘GenericLUT’: Test the generic lookup-table based driver that can handle<br />
arbitrary devices, albeit not with maximum speed. ‘whichDriver’ must be a<br />
struct with the following fields:</p>
<p>whichDriver.name = ‘GenericLUT’</p>
<h3 id="then-either-one-of-these-for-testing-of-a-generic-lut">Then either one of these for testing of a generic LUT:</h3>
<p>whichDriver.bpc = Bitdepths of LUT to test - Anything between 1 and 16.<br />
whichDriver.nslots = Size of LUT in slots - Anything between 2 and 65536.</p>
<p>Alternatively you can test with an existing self-created LUT:<br />
whichDriver.lut = A 3 rows by nslots column uint8 matrix which encodes<br />
the LUT: Rows 1,2 and 3 encode Red, Green and Blue channel, each of the<br />
‘nslots’ columns encodes a LUT slot. The driver will map luminance values<br />
between 0.0 and 1.0 to the corresponding LUT slots in range 1 to nslots,<br />
then readout the stored column vector with the output RGBA8 pixels to<br />
poke into the framebuffer.</p>
<p>* ‘VideoSwitcherSimple’: Test the “simple” driver for the <a href="VideoSwitcher" class="uri">VideoSwitcher</a><br />
video attenuator. The simple driver implements a closed-form solution, a<br />
formula, to map luminance values between 0.0 - 1.0 to output values for<br />
the Red and Blue channel, just using the ‘BTRR’ ratio as parameter. This<br />
is the fast driver, as it doesn’t need any lookup tables.</p>
<p>You should provide the whichDriver.btrr BTRR ratio when testing this<br />
driver. If you omit it, it will be loaded from the configuration file in<br />
the Psychtoolbox configuration directory.</p>
<p>* ‘VideoSwitcherCalibrated’: Test the LUT based driver for the <a href="VideoSwitcher" class="uri">VideoSwitcher</a><br />
video attenuator. This driver computes the Blue channel value by<br />
searching for the given luminance value in a 256 entry lookup table, then<br />
uses a closed-form formula to compute the Red channel drive value from<br />
the luminance and the looked-up blue channel value. This is slower due to table<br />
lookups and requires more involved calibration procedures to build a<br />
lookup table, but it is also potentially more accurate.</p>
<p>You should provide the whichDriver.btrr BTRR ratio when testing this<br />
driver, as well as the 257 slot whichDriver.lut lookup table for blue<br />
channel to measured luminance mapping. See help <a href="PsychVideoSwitcher" class="uri">PsychVideoSwitcher</a> for<br />
more info. If you omit these parameters, a default BTRR and LUT will be<br />
loaded from the Psychtoolbox configuration subdirectory.</p>
<h3 id="optional-parameters">Optional parameters:</h3>
<p>whichScreen = <a href="Screen" class="uri">Screen</a> id of display to test on. Will be the secondardy<br />
display if none provided.</p>
<p>plotdiffs = If set to one, plot diagnostic difference images, if any<br />
differences are detected. By default no such images are<br />
plotted. No images will be plotted if no differences<br />
exist.</p>
<p>forcesuccess = Set this to one if you want to force the test to succeed,<br />
despite detected errors, ie., if you want the GPU<br />
conversion to be used. Only use this if you really know<br />
what you are doing!</p>
<p>Please note that this test script can only test if the correct output to<br />
your systems framebuffer is generated by Psychtoolbox. It can’t detect if<br />
the electronic high precision converter device itself is working<br />
correctly with this data. Only visual inspection and a<br />
photometer/colorimeter test can really tell you if the whole system is<br />
working correctly!</p>
<div class="code_header" style="text-align:right;">
<p><span style="float:left;">Path  </span> <span class="counter">Retrieve <a href=
  "https://raw.github.com/Psychtoolbox-3/Psychtoolbox-3/beta/Psychtoolbox/PsychTests/HighPrecisionLuminanceOutputDriversImagingPipelineTest.m">current version from GitHub</a> | View <a href=
  "https://github.com/Psychtoolbox-3/Psychtoolbox-3/commits/beta/Psychtoolbox/PsychTests/HighPrecisionLuminanceOutputDriversImagingPipelineTest.m">changelog</a></span></p>
</div>
<div class="code">
<p><code>Psychtoolbox/PsychTests/HighPrecisionLuminanceOutputDriversImagingPipelineTest.m</code></p>
</div>

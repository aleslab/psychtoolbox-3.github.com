<h2 id="psychtoolbox-psychdocumentation">[[Psychtoolbox]] › [[PsychDocumentation]]</h2>
<p><a href="DisplayOutputMappings" class="uri">DisplayOutputMappings</a> – How they work, how to resolve problems.</p>
<p>You probably read this text, because <a href="Screen" class="uri">Screen</a>() gave you some error or<br />
warning message about problems with beamposition queries or other<br />
low-level functions and directed you to this document for<br />
troubleshooting.</p>
<p>So, what happened here?</p>
<p>For various low-level operations, e.g., beamposition queries for<br />
timestamping, control of high precision framebuffers and high precision<br />
display devices, and for certain stereo display modes, <a href="Screen" class="uri">Screen</a>() needs to<br />
know which video output connector on your graphics card is connected to<br />
which electronic display scanout engine (a so called “crtc”) in the<br />
graphics card, because it needs to exercise low-level control over the<br />
crtc associated with a specific display. The actual wiring between crtc’s<br />
and display connectors however is not fixed on modern graphics cards, but<br />
it is flexible. The wiring is controlled by electronic programmable<br />
switches, so called multiplexers (“<a href="MUXers" class="uri">MUXers</a>”), which are configured by the<br />
operating system and graphics card driver. Depending on the specific<br />
hardware, operating system and display setup, the wiring can change<br />
dynamically.</p>
<p>You can find more technical details at the following links if you are<br />
interested: <a href="http://www.botchco.com/agd5f/?p=51\" class="uri">http://www.botchco.com/agd5f/?p=51\</a> for AMD/ATI hardware,<br />
and <a href="http://virtuousgeek.org/blog/index.php/jbarnes/2011/01/\" class="uri">http://virtuousgeek.org/blog/index.php/jbarnes/2011/01/\</a> for Intel<br />
hardware.</p>
<p>Sometimes, due to operating system or graphics driver bugs, or system<br />
misconfiguration, the operating system “lies” to <a href="Screen" class="uri">Screen</a>() about the true<br />
wiring. On some systems, the operating system can’t tell <a href="Screen" class="uri">Screen</a>() about the<br />
wiring and <a href="Screen" class="uri">Screen</a>() has to make an educated guess based on some<br />
heuristics - a guess which can go wrong.</p>
<p>Long story short, <a href="Screen" class="uri">Screen</a>() can be wrong about which crtc to access for a<br />
given display, causing the kind of malfunctions, warnings and errors<br />
messages that brought you to this help text. To fix such problems you<br />
need to help <a href="Screen" class="uri">Screen</a>() in one of multiple different ways:</p>
<ol type="1">
<li><p>On MS-Windows, try to update your graphics driver in the hope that<br />
this fixes the problem. Don’t forget to reboot!</p></li>
<li><p>If this doesn’t help, or if you are on Linux or OS/X, try to replug<br />
the displays into different video output connectors on your computer.<br />
E.g., on a single monitor setup, plug the monitor into the other video<br />
output connector. On a dual-display setup, exchange which monitor is<br />
plugged into which connector etc. This replugging will make reality<br />
match the expectations of <a href="Screen" class="uri">Screen</a>(). Don’t forget to restart Matlab or<br />
Octave after the change.</p></li>
<li><p>If 2. doesn’t help or is infeasible or problematic, you can also tell<br />
<a href="Screen" class="uri">Screen</a>() about the true wiring by adding the command<br />
<a href="Screen" class="uri">Screen</a>(‘<a href="Preference" class="uri">Preference</a>’, ‘ScreenToHead’, screen, head, crtc[, rank]); to the<br />
top of your script, before other <a href="Screen" class="uri">Screen</a>() commmands:</p>
<p>On OS/X or Windows, <a href="Screen" class="uri">Screen</a>(‘<a href="Preference" class="uri">Preference</a>’, ‘ScreenToHead’, 0, 1, 1);<br />
would tell <a href="Screen" class="uri">Screen</a>() that the Psychtoolbox screen with screenid 0 is<br />
not connected to video output 0 and crtc 0 (as would be the default),<br />
but to video output 1 and crtc 1.</p>
<p>On Linux the same logic applies. However, on Linux, multiple video<br />
outputs (and thereby display monitors) can be connected to one single<br />
Psychtoolbox screenid (aka X-Window system X-<a href="Screen" class="uri">Screen</a>) to allow for more<br />
flexibility than on the other systems. For this reason an additional<br />
‘rank’ parameter controls which of multiple possible outputs per<br />
screen is remapped. The default ‘rank’ of 0 refers to the primary<br />
display output, the one which is used for stimulus onset timestamping<br />
or framerate queries. It may therefore be neccessary to play with the<br />
‘rank’ parameter as well on multi-display setups with multiple<br />
monitors per Psychtoolbox screen.</p></li>
<li><p>If you have a multi-GPU setup, ie., multiple graphics cards installed<br />
and active at the same time, then <a href="Screen" class="uri">Screen</a>() low-level functions may not<br />
work. More precisely, they will not work at all on MS-Windows. On<br />
Apple OS/X or on Linux you can make them work on exactly one GPU, the<br />
other GPU’s will be ignored. On a dual-gpu hybrid graphics laptop, the<br />
current active display gpu is chosen on Linux and OSX. On a regular multi-<br />
gpu machine, Linux chooses the primary boot gpu, on OSX the first gpu in the<br />
system is chosen for better or worse. You can override the choice by<br />
executing the command <a href="PsychTweak" class="uri">PsychTweak</a>(‘UseGPUIndex’, gpuidx); *before* other<br />
calls to <a href="Screen" class="uri">Screen</a>() to use the GPU with index ‘gpuidx’. If you call the<br />
command after <a href="Screen" class="uri">Screen</a>() has been called already, it will usually not<br />
pick up your new setting! E.g., <a href="PsychTweak" class="uri">PsychTweak</a>(‘UseGPUIndex’, 1); would<br />
instruct <a href="Screen" class="uri">Screen</a>() to use the GPU with index 1, which is the 2nd GPU in<br />
the system, as numbering starts with zero for the 1st GPU.</p>
<p>If you use <a href="PsychTweak" class="uri">PsychTweak</a>() to select a different GPU than the first one,<br />
you often also need to perform the actions explained in step 3 to<br />
manually define which GPU output maps to which display connector, as<br />
the heuristic will most often result in wrong assignments for other<br />
GPU’s than the first one (aka GPU zero).</p>
<p>Also remember that all your visual stimulation (== “experiment”)<br />
displays should be connected to the chosen GPU, not one of the other<br />
<a href="GPUs" class="uri">GPUs</a>! Other <a href="GPUs" class="uri">GPUs</a> should usually only be used for non-Psychtoolbox<br />
purposes, e.g., operator displays like the Matlab or Octave window,<br />
etc. While it is possible to open <a href="Screen" class="uri">Screen</a>() onscreen windows on the<br />
other <a href="GPUs" class="uri">GPUs</a> as well, visual stimulus onset timestamping and other<br />
special functions won’t work there and you’ll likely see a bunch of<br />
timing error warnings (“Synchronization trouble”) for those windows,<br />
which indicate that visual timing on those windows will be broken or<br />
highly unreliable.</p>
<p>For an example case of such a multi-gpu setup under Linux, and the<br />
procedure that resolved problems and made timestamping work, see<br />
Psychtoolbox forum message #16208:</p>
<p>http://tech.groups.yahoo.com/group/psychtoolbox/message/16208</p></li>
</ol>
<p>Good luck with troubleshooting!</p>
<div class="code_header" style="text-align:right;">
<p><span style="float:left;">Path  </span> <span class="counter">Retrieve <a href=
  "https://raw.github.com/Psychtoolbox-3/Psychtoolbox-3/beta/Psychtoolbox/PsychDocumentation/DisplayOutputMappings.m">current version from GitHub</a> | View <a href=
  "https://github.com/Psychtoolbox-3/Psychtoolbox-3/commits/beta/Psychtoolbox/PsychDocumentation/DisplayOutputMappings.m">changelog</a></span></p>
</div>
<div class="code">
<p><code>Psychtoolbox/PsychDocumentation/DisplayOutputMappings.m</code></p>
</div>

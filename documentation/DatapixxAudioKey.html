<h2 id="psychtoolbox-psychhardware-datapixxtoolbox-datapixxbasic">[[Psychtoolbox]] › [[PsychHardware]] › [[DatapixxToolbox]] › [[DatapixxBasic]]</h2>
<p><a href="DatapixxAudioKey" class="uri">DatapixxAudioKey</a> - A prototype implementation of a <a href="DataPixx" class="uri">DataPixx</a><br />
audio-key/voice-key.</p>
<p>This allows to record audio from the Datapixx, optionally synchronized to<br />
visual stimulus onset, optionally with simple but precise timestamping of<br />
onset of audio signals.</p>
<p>This is an experimental proof-of-concept prototype! Its name, behaviour<br />
and interface may change without warning in future beta-releases!</p>
<h1 id="subfunctions-and-their-meaning">Subfunctions and their meaning</h1>
<p><a href="DatapixxAudioKey" class="uri">DatapixxAudioKey</a>(‘Open’ [, sampleRate][, lrMode][, inputJack][, inputGain]);<br />
- Open audio system for recording. This will stop any running audio<br />
acquisition operations. Audio sampling will be performed at the given<br />
optional ‘sampleRate’ between 8000 Hz and 96Khz with the given number of<br />
audio input channels ‘lrMode’ (0 = Mono: Average of left and right<br />
channel, 1 = Only left channel, 2 = Only right channel, 3 = Stereo).<br />
Optionally select ‘inputJack’ as audio input (1=Microphone, 2=Line-In)<br />
and ‘inputGain’ as input amplifier gain. If no ‘inputJack’ is specified<br />
and no input is preselected, ‘inputJack’ will default to microphone<br />
input.</p>
<p><a href="DatapixxAudioKey" class="uri">DatapixxAudioKey</a>(‘<a href="Close" class="uri">Close</a>’);<br />
- <a href="Close" class="uri">Close</a> audio subsystem after stopping any running acquisition operations.</p>
<p>[startTimeBox, startTimeGetSecs] = <a href="DatapixxAudioKey" class="uri">DatapixxAudioKey</a>(‘CaptureNow’ [, maxDurationSecs=30][, startOffsetSecs=0][,bufferBaseAddress=20e6] [, numBufferFrames=maxScheduleFrames]);<br />
- Start audio capture immediately (ie., with minimum possible delay on<br />
your system), return a ‘startTimeBox’ timestamp in Datapixx clock time of<br />
when capture actually started or will start, taking the ‘startOffsetSecs’<br />
into account. You can also use the 2nd optional return argument<br />
‘startTimeGetSecs’ to get the same timestamp mapped to Psychtoolbox<br />
<a href="GetSecs" class="uri">GetSecs</a>() time. For a more precise mapping to <a href="GetSecs" class="uri">GetSecs</a> time, you can<br />
convert the ‘startTimeBox’ timestamp into Psychtoolbox <a href="GetSecs" class="uri">GetSecs</a>() time<br />
with the proper mapping functions of <a href="PsychDataPixx" class="uri">PsychDataPixx</a> (see “help<br />
<a href="PsychDataPixx" class="uri">PsychDataPixx</a>”).</p>
<p>The optional ‘startOffsetSecs’ allows to delay the start of the capture<br />
operation by ‘startOffsetSecs’ seconds. The optional ‘maxDurationSecs’<br />
allows to define an upper limit onto the duration of the audio capture<br />
operation. The operation will stop automatically after the given number<br />
of seconds. By default, capture will run for 30 seconds. For<br />
robustness and efficiency, you should specify a reasonable upper limit if<br />
possible. ‘bufferBaseAddress’ is the memory start address of the audio<br />
buffer for capture, ‘numBufferFrames’ is the size of the buffer. See<br />
“Datapixx <a href="SetAudioSchedule" class="uri">SetAudioSchedule</a>?” for more info. Leave at default settings if<br />
possible.</p>
<p><a href="DatapixxAudioKey" class="uri">DatapixxAudioKey</a>(‘CaptureAtFlip’[, flipCount=next][, maxDurationSecs=30][, startOffsetSecs=0][,bufferBaseAddress=20e6] [, numBufferFrames=maxScheduleFrames]);<br />
- Schedule start of audio capture synchronized to the visual stimulus<br />
onset of a future <a href="Screen" class="uri">Screen</a>(‘<a href="Flip" class="uri">Flip</a>’) or <a href="Screen" class="uri">Screen</a>(‘AsyncFlipBegin’) command.<br />
All parameters are identical to the ones for <a href="DatapixxAudioKey" class="uri">DatapixxAudioKey</a>(‘CaptureNow’,…),<br />
except for the first optional parameter ‘flipCount’. ‘flipCount’ defines<br />
at which <a href="Screen" class="uri">Screen</a>(‘<a href="Flip" class="uri">Flip</a>’) audio capture should be started. If omitted or<br />
set to zero or [], capture will be triggered by the next flip command.<br />
Otherwise it will be triggered by the flip command with the given<br />
‘flipCount’. You can query the current flipCount via <a href="PsychDatapixx" class="uri">PsychDatapixx</a>(‘FlipCount’).</p>
<p>Example: Setting flipCount = <a href="PsychDatapixx" class="uri">PsychDatapixx</a>(‘FlipCount’) + 10; would start<br />
audio capture at the 10’th invocation of a flip command from now.</p>
<p>This function doesn’t return a capture start timestamp as capture will<br />
only happen in the future, so the timestamp is only available in the<br />
future.</p>
<p>[audiodata, onsetTimeSecs] = <a href="DatapixxAudioKey" class="uri">DatapixxAudioKey</a>(‘GetResponse’[, amountSecs=current][, blocking=1][, stopCapture=0]);<br />
- Try to fetch available captured audiodata from a running capture<br />
operation. Only call this function after a capture operation has been<br />
started via <a href="DatapixxAudioKey" class="uri">DatapixxAudioKey</a>(‘CaptureNow’) or scheduled for start at a<br />
certain flipCount via <a href="DatapixxAudioKey" class="uri">DatapixxAudioKey</a>(‘CaptureAtFlip’) and the flip is<br />
imminent, i.e., after the flip command for that flip has been called<br />
already. The function will error-out if you call it too early!</p>
<p>The optional ‘amountSecs’ asks the driver to return exactly<br />
‘amountSecs’ worth of audio data. By default it will return whatever<br />
is available at time of call. If ‘amountSecs’ is specified, but the<br />
requested amount is not yet available, the optional ‘blocking’ flag will<br />
define behaviour: If set to 1 (default), the driver will wait until the<br />
specified amount becomes available. If set to 0, the driver will return<br />
with empty [] return arguments so you can retry later. The optional<br />
‘stopCapture’ flag if set to 1 will stop audio capture, its default<br />
setting of zero will keep capture running until manually stopped or until<br />
it stops by itself.</p>
<p>‘audiodata’ is the vector or matrix of captured audiodata. 1 Row for mono<br />
recording, or a 2-row matrix (one row for each audio channel) in stereo<br />
recording modes. Each value is an audio signal sample in range [-1 ; 1].</p>
<p>‘onsetTimeSecs’ is the time since start of audio capture when a certain<br />
level of loudness (as set by <a href="DatapixxAudioKey" class="uri">DatapixxAudioKey</a>(‘TriggerLevel’)) was first<br />
exceeded, e.g., due to onset of a vocal response of a subject.</p>
<p>‘readOffset’ is the sample index of the next sample that will be read on<br />
the next call to this function, if any.</p>
<p>oldLevel = <a href="DatapixxAudioKey" class="uri">DatapixxAudioKey</a>(‘TriggerLevel’ [, newLevel]);<br />
- Return old and optionally set new trigger threshold level for the<br />
timestamping of onset of audio signals in <a href="DatapixxAudioKey" class="uri">DatapixxAudioKey</a>(‘GetResponse’).</p>
<p>‘oldLevel’ is the current/old level. ‘newLevel’ is the optional new<br />
level. Level can be between 0 and 1, with a default level of 0.1 for 10%<br />
of max signal intensity as trigger level.</p>
<p><a href="DatapixxAudioKey" class="uri">DatapixxAudioKey</a>(‘AutoTriggerLevel’, silenceSecs);<br />
- Auto-Select trigger threshold level for audio onset timestamping. After<br />
start of audio capture, there must be a period of silence, where the only<br />
signal recorded is due to noise in the microphone/amplifiers etc, not due<br />
to actual signal. You must provide the minimum duration of this time<br />
period of silence as ‘silenceSecs’ parameter, e.g., 1.5 for 1.5 seconds<br />
of guaranteed silence at start of recording. During recording, the<br />
function will use this chunk of silence to compute an optimal trigger<br />
level, which is 10% louder than the loudest sample in the silence block<br />
and then use that triggerlevel as if <a href="DatapixxAudioKey" class="uri">DatapixxAudioKey</a>(‘TriggerLevel’) had<br />
been called with that auto-selected level.</p>
<p><a href="DatapixxAudioKey" class="uri">DatapixxAudioKey</a>(‘StopCapture’);<br />
- Stop audio capture as soon as possible.</p>
<div class="code_header" style="text-align:right;">
<p><span style="float:left;">Path  </span> <span class="counter">Retrieve <a href=
  "https://raw.github.com/Psychtoolbox-3/Psychtoolbox-3/beta/Psychtoolbox/PsychHardware/DatapixxToolbox/DatapixxBasic/DatapixxAudioKey.m">current version from GitHub</a> | View <a href=
  "https://github.com/Psychtoolbox-3/Psychtoolbox-3/commits/beta/Psychtoolbox/PsychHardware/DatapixxToolbox/DatapixxBasic/DatapixxAudioKey.m">changelog</a></span></p>
</div>
<div class="code">
<p><code>Psychtoolbox/PsychHardware/DatapixxToolbox/DatapixxBasic/DatapixxAudioKey.m</code></p>
</div>

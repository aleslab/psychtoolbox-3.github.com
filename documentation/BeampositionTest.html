<h2 id="psychtoolbox-psychtests">[[Psychtoolbox]] › [[PsychTests]]</h2>
<p><a href="BeampositionTest" class="uri">BeampositionTest</a> - Test GPU scanout position (“beamposition”) queries.</p>
<p>Usage: <a href="BeampositionTest" class="uri">BeampositionTest</a>([n=10000][, screenid=max][, synced=0])</p>
<p>Opens a onscreen window on screen ‘screenid’ (default = maximum screenid)<br />
and runs a sample loop, performing ‘n’ (default 10000) beamposition<br />
queries, either as fast as it can if ‘synced’ == 0, or it performs<br />
<a href="Screen" class="uri">Screen</a>(‘<a href="Flip" class="uri">Flip</a>’) and takes one sample after each flip, ie., in sync with<br />
vertical retrace.</p>
<p>Then it plots its samples in multiple figures:<br />
Beamposition vs. sample count, Beamposition vs. time, a histogram of all<br />
sampled beampositions, and the duration of each query in msecs.</p>
<h3 id="heres-what-you-should-see-on-a-properly-working-system">Here’s what you should see on a properly working system:</h3>
<p>Beamposition against time or samplecount should show a periodic sawtooth pattern,<br />
where scanout starts at zero and increments up to the value VBL Endline,<br />
as reported by PTB’s Matlab output. The histogram should show an even<br />
distribution (a flat line) across all bins from bin 0 to bin “VBL<br />
Endline”. Query times should be in the low microsecond range, e.g.,<br />
not much more than 20-30 usecs on a modern machine on average.</p>
<h3 id="other-things-you-might-see">Other things you might see:</h3>
<p>Periodic spikes in the query times and possibly some gaps, or total loss<br />
of signal in the histogram at values higher than “VBL Startline” and or a<br />
spike in the histogram for beamposition bin zero: Your graphics driver or<br />
hardware has a small bug for which PTB can compensate, at the cost of<br />
higher query times and thereby slightly degraded realtime behaviour of<br />
your system. This is usually accompanied by some warnings wrt. slightly<br />
broken beamposition queries.</p>
<p>No spikes in query times but no values abouve “VBL Startline” at all in<br />
the histograms and plots: A slightly broken graphics driver, but PTB<br />
couldn’t compensate for the bug because it didn’t detect the problem.<br />
Manual ways to enable the workaround are explained in ‘help<br />
ConserveVRAMSettings’, section ‘kPsychUseBeampositionQueryWorkaround’.</p>
<p>Beampositions implausibly high or low for your display. PTB may query the<br />
wrong display on a multi-display setup. See ‘help DisplayOutputMappings’<br />
for remedies.</p>
<p>A flat-line of all-zero beampositions: Beamposition queries are<br />
unsupported, disabled or broken on your setup. If you know they should<br />
work, then PTB may query the wrong display on a multi-display setup. See<br />
‘help DisplayOutputMappings’ for remedies. Another possible fix is<br />
installing and loading the <a href="PsychtoolboxKernelDriver" class="uri">PsychtoolboxKernelDriver</a> on OSX (‘help<br />
PsychtoolboxKernelDriver’) or running <a href="PsychLinuxConfiguration" class="uri">PsychLinuxConfiguration</a> on Linux<br />
and rebooting the machine once to enable our own beamposition query<br />
mechanism. On Linux this is not needed when using the free and<br />
open-source graphics drivers, as these have a builtin timestamping<br />
mechanism which is even more robust and precise than beampositionq<br />
queries. On Linux with <a href="NVidia" class="uri">NVidia</a> or AMD proprietary binary drivers this is<br />
always needed once for a given machine. On OSX it is increasingly needed<br />
due to total lack of OS support on Intel and AMD graphics cards and<br />
increasingly broken support for <a href="NVidia" class="uri">NVidia</a> graphics cards. On OSX with <a href="NVidia" class="uri">NVidia</a><br />
graphics cards you additionally need to apply the measures explained in<br />
‘help ConserveVRAMSettings’ - the section about kPsychDontUseNativeBeamposQuery.</p>
<p>A flat-line not at zero, but at some fixed value. See previous paragraph:<br />
Install the kernel drivers or setup Linux properly, apply the kPsychDontUseNativeBeamposQuery<br />
fix on OSX, possibly apply measures from ‘help DisplayOutputMappings’.</p>
<p>Weird looking non-sawtooth patterns: This is a totally broken graphics<br />
driver, often to be found on Apple machines running OSX with Apple Retina<br />
displays or other LCD flat panels. See previous paragraph for fixes.</p>
<p>-&gt; Most fixes involve switching to our own implementation of beamposition<br />
queries instead of using broken or missing OS implementations, and then<br />
some fiddling around.</p>
<p>-&gt; On MS-Windows there’s usually no way to fix broken queries beyond the<br />
automatic fixes applied by <a href="Screen" class="uri">Screen</a>() if it detects a problem.</p>
<div class="code_header" style="text-align:right;">
<p><span style="float:left;">Path  </span> <span class="counter">Retrieve <a href=
  "https://raw.github.com/Psychtoolbox-3/Psychtoolbox-3/beta/Psychtoolbox/PsychTests/BeampositionTest.m">current version from GitHub</a> | View <a href=
  "https://github.com/Psychtoolbox-3/Psychtoolbox-3/commits/beta/Psychtoolbox/PsychTests/BeampositionTest.m">changelog</a></span></p>
</div>
<div class="code">
<p><code>Psychtoolbox/PsychTests/BeampositionTest.m</code></p>
</div>

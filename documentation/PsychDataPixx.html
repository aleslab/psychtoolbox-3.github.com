<h2 id="psychtoolbox-psychhardware-datapixxtoolbox-datapixxbasic">[[Psychtoolbox]] › [[PsychHardware]] › [[DatapixxToolbox]] › [[DatapixxBasic]]</h2>
<p><a href="PsychDataPixx" class="uri">PsychDataPixx</a> - High level control driver for the <a href="VPixx" class="uri">VPixx</a> - <a href="DataPixx" class="uri">DataPixx</a> device.</p>
<p>This driver provides common high-level functionality for interaction with<br />
the <a href="VPixx" class="uri">VPixx</a> Technologies <a href="DataPixx" class="uri">DataPixx</a> device. The driver provides high-level<br />
functions for basic device operations and for timestamping of visual<br />
stimulus onset. It also provides functionality needed for the<br />
<a href="PsychImaging" class="uri">PsychImaging</a>() command and the <a href="Screen" class="uri">Screen</a>() image processing pipeline to<br />
properly setup the high-precision video display modes and stereo display<br />
modes of the <a href="DataPixx" class="uri">DataPixx</a>.</p>
<p>The driver is dependend on the low-level MEX file Datapixx() driver to be<br />
present. It will fail if that MEX file is missing or dysfunctional.</p>
<p>Normally you will have a <a href="DataPixx" class="uri">DataPixx</a> connected when using this driver, but<br />
for basic code development and testing you can call<br />
<a href="PsychDataPixx" class="uri">PsychDataPixx</a>(‘SetDummyMode’, 1); and then run without a connected<br />
<a href="DataPixx" class="uri">DataPixx</a> device.</p>
<p>For control of visual stimulus display on the <a href="DataPixx" class="uri">DataPixx</a>, read the relevant<br />
sections of the help of <a href="PsychImaging" class="uri">PsychImaging</a>. That command will take care of most<br />
of the details of visual setup.</p>
<h1 id="commands-and-their-syntax">Commands and their syntax</h1>
<p>oldmode = <a href="PsychDataPixx" class="uri">PsychDataPixx</a>(‘SetDummyMode’ [, mode]);<br />
- Switch driver into dummy mode if ‘mode’ is set to 1. In dummy mode, the<br />
code mostly operates without a <a href="DataPixx" class="uri">DataPixx</a> device connected. This is useful<br />
for basic debugging of code without access to the device. The simulated<br />
device returns more or less meaningful values, good enough for initial<br />
code development.</p>
<p>A ‘mode’ setting of zero enabled normal mode of operation.<br />
You must call this command before any other command for proper operation!</p>
<p><a href="PsychDataPixx" class="uri">PsychDataPixx</a>(‘Open’);<br />
- Open a connection to the device, with default settings. If the device<br />
is already open then this will do almost nothing, otherwise the<br />
connection is opened.</p>
<p>You must call this function before all other remaining commands!</p>
<p><a href="PsychDataPixx" class="uri">PsychDataPixx</a>(‘<a href="Close" class="uri">Close</a>’);<br />
- <a href="Close" class="uri">Close</a> a connection to the device. Multiple virtual connections can be<br />
simultaneously open. If this function call closes the last virtual<br />
connection, then the real physical connection to the device is closed and<br />
the driver is reset.</p>
<p>If you used <a href="PsychImaging" class="uri">PsychImaging</a>() to make use of Datapixx graphics mode, it will<br />
automatically close that connection once the corresponding onscreen<br />
window is closed. As a simple rule, you only need to call the ‘<a href="Close" class="uri">Close</a>’<br />
function if you also called the ‘Open’ function before.</p>
<p>Call this command as last command in your script! All further<br />
<a href="PsychDataPixx" class="uri">PsychDataPixx</a>() commands will be invalid after a ‘<a href="Close" class="uri">Close</a>’ call!</p>
<p>status = <a href="PsychDataPixx" class="uri">PsychDataPixx</a>(‘GetStatus’ [,newstatus]);<br />
- Retrieve a struct ‘status’ with the complete driver internal state.<br />
Optionally assign new state ‘newstatus’ to driver. Only assign a new<br />
state if you *really* know what you’re doing!</p>
<p>oldmode = <a href="PsychDataPixx" class="uri">PsychDataPixx</a>(‘LogOnsetTimestamps’, mode);<br />
- Return current timestamp acquisition mode as optional return argument<br />
‘oldmode’. Set a new mode, according to argument ‘mode’. ‘mode’ can<br />
be one of:</p>
<p>0 = Disable all timestamp acquisition and logging.<br />
1 = Log a visual stimulus onset timestamp for the next <a href="Screen" class="uri">Screen</a>(‘<a href="Flip" class="uri">Flip</a>’) or<br />
<a href="Screen" class="uri">Screen</a>(‘AsyncFlipBegin’) command after this function call, then stop<br />
logging again. This is a one-shot timestamp function.<br />
2 = Log all <a href="Screen" class="uri">Screen</a>(‘<a href="Flip" class="uri">Flip</a>’) and <a href="Screen" class="uri">Screen</a>(‘AsyncFlipBegin’) visual stimulus<br />
onset timestamps until this function is called again with a ‘mode’<br />
setting of 1 or 0.</p>
<p>Timestamping is disabled by default (mode == 0), as it incurs a bit of<br />
computational overhead to acquire and log timestamps, typically up to 2-3<br />
msecs of extra time per ‘<a href="Flip" class="uri">Flip</a>’ command.</p>
<p>The driver will log all timestamps in a buffer, which can be read out via<br />
the following timestamp related commands.</p>
<p>[boxTime, getsecsTime, flipCount, currentFlipcount] = <a href="PsychDataPixx" class="uri">PsychDataPixx</a>(‘GetLastOnsetTimestamp’);<br />
- Retrieve visual stimulus onset timestamps related to last logged<br />
“<a href="Flip" class="uri">Flip</a>”. This call will only return valid values after a <a href="Flip" class="uri">Flip</a> command is<br />
finished, ie., after a successfull call to <a href="Screen" class="uri">Screen</a>(‘<a href="Flip" class="uri">Flip</a>’) or<br />
<a href="Screen" class="uri">Screen</a>(‘AsyncFlipCheckEnd’) or <a href="Screen" class="uri">Screen</a>(‘AsyncFlipEnd’), and only if<br />
logging of timestamps was enabled by setting the ‘LogOnsetTimestamps’<br />
mode (see above) to a non-zero value. It always returns the most recently<br />
acquired timestamp.</p>
<p>‘boxTime’ is the time in seconds of stimulus onset as measured by the<br />
<a href="DataPixx" class="uri">DataPixx</a> internal clock.<br />
‘getsecsTime’ is the time in seconds of stimulus onset as measured by the<br />
Psychtoolbox <a href="GetSecs" class="uri">GetSecs</a>() clock.<br />
‘flipCount’ is the “serial number” of the <a href="Screen" class="uri">Screen</a> flip command to which<br />
the returned timestamps refer.<br />
‘currentFlipcount’ is the “serial number” of the most recent <a href="Screen" class="uri">Screen</a> flip<br />
command.</p>
<p>Computation of ‘getsecsTime’ will become inaccurate if you don’t<br />
frequently call <a href="PsychDataPixx" class="uri">PsychDataPixx</a>(‘GetPreciseTime’) to resynchronize the<br />
clocks! A more accurate approach to retrieve <a href="GetSecs" class="uri">GetSecs</a>() style timestamps<br />
is to use the <a href="PsychDataPixx" class="uri">PsychDataPixx</a>(‘GetTimestampLog’, 1) function to retrieve<br />
all logged timestamps at the end of a session and apply some<br />
high-precision remapping of timestamps.</p>
<p>[getsecs, boxsecs, confidence] = <a href="PsychDataPixx" class="uri">PsychDataPixx</a>(‘GetPreciseTime’);<br />
- Query both the <a href="DataPixx" class="uri">DataPixx</a> clock and <a href="GetSecs" class="uri">GetSecs</a> clock and compute which <a href="GetSecs" class="uri">GetSecs</a><br />
time ‘getsecs’ corresponds to which Datapixx time ‘boxsecs’ and how<br />
reliable this correspondence is in ‘confidence’. ‘confidence’ is the<br />
margin of error between both timestamps.<br />
This function implicitely synchronizes both clocks to get more precise<br />
values for ‘getsecstime’ from calls to <a href="PsychDataPixx" class="uri">PsychDataPixx</a>(‘GetLastOnsetTimestamp’);<br />
The function is automatically called once at device open time.</p>
<p>log = <a href="PsychDataPixx" class="uri">PsychDataPixx</a>(‘GetTimestampLog’ [, remapPrecise = 0]);<br />
- Fetch the full log of all acquired visual stimulus onset timestamps<br />
into the variable ‘log’. ‘log’ is a 3-by-n matrix for the n timestamps,<br />
one column encodes one stimulus onset, aka one logged invocation of<br />
<a href="Screen" class="uri">Screen</a>(‘<a href="Flip" class="uri">Flip</a>’) et al.</p>
<p>log(1,i) = i’th timestamp as measured via the Datapixx internal clock.<br />
log(2,i) = i’th timestamp as measured via the Psychtoolbox <a href="GetSecs" class="uri">GetSecs</a> clock.<br />
log(3,i) = <a href="Flip" class="uri">Flip</a> serial number of i’th sample.</p>
<p>If the optional parameter ‘remapPrecise’ is set to 1, then an expensive<br />
calibration procedure is used to compute very precise <a href="GetSecs" class="uri">GetSecs</a>()<br />
timestamps for row 2 of the returned matrix, otherwise a cheap but<br />
inaccurate remapping is performed. The expensive procedure can take up to<br />
1 second, but is highly recommended for precise timestamps. See<br />
explanation of ‘BoxsecsToGetsecs’ function below for more details. You’ll<br />
typically call this function only at the end of an experiment session.</p>
<p><a href="PsychDataPixx" class="uri">PsychDataPixx</a>(‘ClearTimestampLog’);<br />
- Clear the log with all currently acquired timestamps.</p>
<p>tgetsecs = <a href="PsychDataPixx" class="uri">PsychDataPixx</a>(‘FastBoxsecsToGetsecs’, t);<br />
- Map given timestamp ‘t’ in Datapixx clock time to Psychtoolbox <a href="GetSecs" class="uri">GetSecs</a><br />
time and return it in ‘tgetsecs’. This mapping is only precise if you<br />
call <a href="PsychDataPixx" class="uri">PsychDataPixx</a>(‘GetPreciseTime’); frequently. For a more accurate<br />
remapping use the following <a href="PsychDataPixx" class="uri">PsychDataPixx</a>(‘BoxsecsToGetsecs’, t);<br />
instead, which is more time consuming to execute though.</p>
<p>[tgetsecs, sd, ratio] = <a href="PsychDataPixx" class="uri">PsychDataPixx</a>(‘BoxsecsToGetsecs’, t);<br />
- Perform remapping of a vector of Datapixx timestamps ‘t’, ie.,<br />
timestamps expressed in Datapixx clock time, into Psychtoolbox <a href="GetSecs" class="uri">GetSecs</a><br />
timestamps ‘tgetsecs’. Return measures of accuracy of remapping.</p>
<p>This must be called while the device is still open! It performs the same<br />
calibration procedure as <a href="PsychDataPixx" class="uri">PsychDataPixx</a>(‘GetTimestampLog’, 1); and can<br />
easily take up to 1 second of time.</p>
<p>The remapping is performed by fitting a mapping function to the set of<br />
acquired timestamp samples from both the Psychtoolbox <a href="GetSecs" class="uri">GetSecs</a> clock and<br />
the <a href="DataPixx" class="uri">DataPixx</a> clock. The best fit function is used for mapping <a href="DataPixx" class="uri">DataPixx</a><br />
timestamps in ‘t’ to PTB timestamps in ‘tgetsecs’. ‘sd’ is the standard<br />
deviation of the best-fit function wrt. to fitting error. ‘ratio’ is an<br />
estimate of the clock speed difference between the host clock and the<br />
Datapixx clock.</p>
<p><a href="PsychDataPixx" class="uri">PsychDataPixx</a>(‘RequestPsyncedUpdate’);<br />
- Request an update of the <a href="DataPixx" class="uri">DataPixx</a> register block in sync with the next<br />
visual stimulus onset as triggered by <a href="Screen" class="uri">Screen</a>(‘<a href="Flip" class="uri">Flip</a>’) or<br />
<a href="Screen" class="uri">Screen</a>(‘AsyncFlipBegin’). This will emit the neccessary PSYNC pixel<br />
sequence at next flip and tell the device to apply all pending settings<br />
on reception of that PSYNC token.</p>
<p>count = <a href="PsychDataPixx" class="uri">PsychDataPixx</a>(‘FlipCount’);<br />
- Return “serial number” of the last executed visual stimulus update via<br />
one of the <a href="Screen" class="uri">Screen</a> “<a href="Flip" class="uri">Flip</a>” commands.</p>
<p><a href="PsychDataPixx" class="uri">PsychDataPixx</a>(‘ExecuteAtFlipCount’, targetFlipCount, commandString);<br />
- Request execution of ‘commandString’ via eval() function in sync with<br />
the <a href="Screen" class="uri">Screen</a>(‘<a href="Flip" class="uri">Flip</a>’) or <a href="Screen" class="uri">Screen</a>(‘AsyncFlipBegin’) command which will<br />
cause the stimulus onset with “serial number” ‘targetFlipCount’. You can<br />
ask for the current “serial number” by calling current = <a href="PsychDataPixx" class="uri">PsychDataPixx</a>(‘FlipCount’);<br />
Providing an empty ‘targetFlipCount’ means to execute at next flip.</p>
<p>Datapixx related commands in ‘commandString’ will be scheduled for<br />
execution on the device at next visual stimulus onset by use of the psync<br />
mechanism.</p>
<p>Not all commands are allowed inside ‘commandString’! Any call to <a href="Screen" class="uri">Screen</a>()<br />
or any <a href="OpenGL" class="uri">OpenGL</a> command is forbidden. Datapixx commands which could block<br />
execution to wait for the Datapixx , e.g., Datapixx(‘RegWrRd’) are<br />
problematic, and the calls Datapixx(‘RegWrPixelSync’) and<br />
Datapixx(‘RegWrRdPixelSync’) are strictly forbidden!</p>
<p>This function is mostly used by other higher-level <a href="DataPixxToolbox" class="uri">DataPixxToolbox</a><br />
functions, e.g., for I/O (sound, digital or analog), in order to<br />
synchronize their operation and schedules to visual stimulus updates.</p>
<p><a href="PsychDataPixx" class="uri">PsychDataPixx</a>(‘LoadIdentityClut’, win);<br />
- Load an identity CLUT into the device at next stimulus onset, ie., next<br />
‘<a href="Flip" class="uri">Flip</a>’ command for window ‘win’. This is a pure convenience function for<br />
that common case. Normally you’d use <a href="Screen" class="uri">Screen</a>(‘LoadNormalizedGammaTable’, win, clut, 2);<br />
to upload a new ‘clut’ table at next ‘<a href="Flip" class="uri">Flip</a>’ command execution.</p>
<p>oldverbosity = <a href="PsychDataPixx" class="uri">PsychDataPixx</a>(‘Verbosity’ [,verbosity]);<br />
- Retrieve and optionally set a new level of ‘verbosity’ for driver debug<br />
output. verbosity can be 0 for no output, 1 for only errors, 2 for<br />
additionally warnings, 3 for additional info, 4 for very verbose output.</p>
<p>oldtimeout = <a href="PsychDataPixx" class="uri">PsychDataPixx</a>(‘PsyncTimeoutFrames’ [, timeoutFrames]);<br />
– Query and/or set timeout (in video refresh cycles) for recognition of<br />
PSYNC codes by the device. By default, the timeout is set to the<br />
equivalent of 5 minutes, which means: If the device is instructed to wait<br />
for a PSYNC marker token in the video stream, but doesn’t receive the<br />
expected token within 5 minutes, it will continue processing as if the<br />
token was received. This is used to prevent device-hangs on programming<br />
errors or other malfunctions. The default setting of 5 minutes is very<br />
generous. You can override this default and set an arbitrary timeout<br />
between 1 and 65535 video refresh cycles with this function.</p>
<p>Normally you won’t call the following functions yourself, as Psychtoolbox<br />
automatically performs neccessary setup during calls to <a href="PsychImaging" class="uri">PsychImaging</a>()<br />
that are related to the <a href="DataPixx" class="uri">DataPixx</a> device (“help <a href="PsychImaging" class="uri">PsychImaging</a>” for<br />
details).</p>
<p><a href="PsychDataPixx" class="uri">PsychDataPixx</a>(‘SetVideoMode’, mode);<br />
– Switch <a href="DPixx" class="uri">DPixx</a> device immediately into video processing mode ‘mode’.<br />
Type “Datapixx <a href="SetVideoMode" class="uri">SetVideoMode</a>?” for a list of available ‘mode’ settings and<br />
explanation of their purpose and behaviour.</p>
<p><a href="PsychDataPixx" class="uri">PsychDataPixx</a>(‘SetVideoHorizontalSplit’, mode);<br />
– Switch <a href="DPixx" class="uri">DPixx</a> device immediately into video split mode ‘mode’.<br />
Type “Datapixx <a href="SetVideoHorizontalSplit" class="uri">SetVideoHorizontalSplit</a>?” for a list of available ‘mode’<br />
settings and explanation of their purpose and behaviour.</p>
<p><a href="PsychDataPixx" class="uri">PsychDataPixx</a>(‘SetVideoVerticalStereo’, mode);<br />
– Switch <a href="DPixx" class="uri">DPixx</a> device immediately into vertical stereo video mode ‘mode’.<br />
Type “Datapixx <a href="SetVideoVerticalStereo" class="uri">SetVideoVerticalStereo</a>?” for a list of available ‘mode’<br />
settings and explanation of their purpose and behaviour.</p>
<p><a href="PsychDataPixx" class="uri">PsychDataPixx</a>(‘EnableVideoScanningBacklight’);<br />
– Enable <a href="ViewPixx" class="uri">ViewPixx</a> panels scanning backlight.</p>
<p><a href="PsychDataPixx" class="uri">PsychDataPixx</a>(‘DisableVideoScanningBacklight’);<br />
– Disable <a href="ViewPixx" class="uri">ViewPixx</a> panels scanning backlight.</p>
<p><a href="PsychDataPixx" class="uri">PsychDataPixx</a>(‘EnableVideoStereoBlueline’);<br />
– Enable detection and handling of blue-line stereo sync lines by the<br />
<a href="DataPixx" class="uri">DataPixx</a>.</p>
<p><a href="PsychDataPixx" class="uri">PsychDataPixx</a>(‘DisableVideoStereoBlueline’);<br />
– Disable detection and handling of blue-line stereo sync lines by the<br />
<a href="DataPixx" class="uri">DataPixx</a>.</p>
<p>Internal commands: NOT FOR USE BY PURE MORTALS!</p>
<p><a href="PsychDataPixx" class="uri">PsychDataPixx</a>(‘PerformPostWindowOpenSetup’);<br />
– Called by <a href="PsychImaging" class="uri">PsychImaging</a>(‘OpenWindow’) after opening a window on the<br />
device. Performs all low-level setup for use of <a href="DataPixx" class="uri">DataPixx</a>.</p>
<p>rc = <a href="PsychDataPixx" class="uri">PsychDataPixx</a>(‘CheckGPUSanity’, window, xoffset);<br />
– Perform online-test of GPU identity gamma tables and DVI-D display<br />
encoders. Try to correct problems with wrong identity gamma tables and at<br />
least detect problems with (spatio-)temporal display dithering. Returns<br />
rc == 0 on full success, rc &gt; 0 on failure.</p>
<p><a href="PsychDataPixx" class="uri">PsychDataPixx</a>(-1);<br />
– PTB callback: Request immediate emission of a PSYNC’ed <a href="RegWrRd" class="uri">RegWrRd</a> command<br />
to driver if a PSYNC is pending. Otherwise noop.</p>
<p><a href="PsychDataPixx" class="uri">PsychDataPixx</a>(0);<br />
– PTB callback at ‘<a href="Flip" class="uri">Flip</a>’ time: Do whatever <a href="DPixx" class="uri">DPixx</a> related work is<br />
pending for next ‘<a href="Flip" class="uri">Flip</a>’, e.g., <a href="DPixx" class="uri">DPixx</a> clut updates, writing of PSYNC pixel<br />
sequences, preparation of logging of timestamps etc.</p>
<p><a href="PsychDataPixx" class="uri">PsychDataPixx</a>(1, clut);<br />
– Callback for PTB imaging pipeline: Ultrafast upload of given ‘clut’<br />
into the device at next bufferswap.</p>
<p><a href="PsychDataPixx" class="uri">PsychDataPixx</a>(2);<br />
– Callback for PTB imaging pipeline after successfull finish of a<br />
bufferswap. Do whatever needs to be done, e.g., incrementing the<br />
swapcounter and logging of timestamps.</p>
<p><a href="PsychDataPixx" class="uri">PsychDataPixx</a>(3);<br />
– Callback at time of closing the <a href="DataPixx" class="uri">DataPixx</a> onscreen window: Perform<br />
whatever actions are needed at shutdown, e.g., restoring identity clut on<br />
device, restoring default video mode and settings, closing device<br />
connection, cleanup of data structures etc.</p>
<div class="code_header" style="text-align:right;">
<p><span style="float:left;">Path  </span> <span class="counter">Retrieve <a href=
  "https://raw.github.com/Psychtoolbox-3/Psychtoolbox-3/beta/Psychtoolbox/PsychHardware/DatapixxToolbox/DatapixxBasic/PsychDataPixx.m">current version from GitHub</a> | View <a href=
  "https://github.com/Psychtoolbox-3/Psychtoolbox-3/commits/beta/Psychtoolbox/PsychHardware/DatapixxToolbox/DatapixxBasic/PsychDataPixx.m">changelog</a></span></p>
</div>
<div class="code">
<p><code>Psychtoolbox/PsychHardware/DatapixxToolbox/DatapixxBasic/PsychDataPixx.m</code></p>
</div>

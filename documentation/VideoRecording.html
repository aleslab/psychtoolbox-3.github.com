<h2 id="psychtoolbox-psychdocumentation">[[Psychtoolbox]] › [[PsychDocumentation]]</h2>
<p><a href="VideoRecording" class="uri">VideoRecording</a> - Parameter settings, howtos and tips for Video recording.</p>
<p>This file describes how to use the [<a href="GStreamer" class="uri">GStreamer</a>][(GStreamer)]((GStreamer)) and DC1394 video capture engines<br />
for video (and audio) recording into movie files. The [<a href="GStreamer" class="uri">GStreamer</a>][(GStreamer)]((GStreamer)) engine is<br />
available on all operating systems and can record both video and sound.<br />
The DC1394 engine is available on Linux and OSX and can currently only<br />
record video, but no simultaneous audio.</p>
<ul>
<li><p>Check <a href="VideoRecordingDemo" class="uri">VideoRecordingDemo</a> for regular video recording via [<a href="GStreamer" class="uri">GStreamer</a>][(GStreamer)]((GStreamer))! On<br />
both <a href="MacOSX" class="uri">MacOSX</a> and MS-Windows, one often needs to pass special settings or<br />
codec types for video recording and especially combined video + audio<br />
recording to work. That demo illustrates at least one set of settings<br />
which were shown to work on OSX and Windows in December 2013.</p></li>
<li><p>Check <a href="VideoDVCamCaptureDemo" class="uri">VideoDVCamCaptureDemo</a> for video recording from DV cameras. These<br />
cameras seem to need special treatment on all systems, but especially<br />
on MS-Windows and the demo shows how to do that.</p></li>
<li><p>Check <a href="VideoMultiCameraCaptureDemo" class="uri">VideoMultiCameraCaptureDemo</a> for video capture and recording from<br />
multiple professional class IIDC/DCAM compliant firewire and USB cameras<br />
on Linux and OSX via the DC1394 engine.</p></li>
</ul>
<h3 id="codec-and-parameter-selection">Codec and parameter selection:</h3>
<p>If you only want to record a movie with default settings, specify its<br />
filename as ‘targetmoviename’ parameter to <a href="Screen" class="uri">Screen</a>(‘OpenVideocapture’, …);</p>
<p>If you want to specify codecs and their settings as well, it is recommended<br />
that you specify these settings in the ‘targetmoviename’ and specify the<br />
moviefile name separately via the <a href="Screen" class="uri">Screen</a>(‘SetVideoCaptureParameter’) interface,<br />
e.g., to set the movie name to ‘foo.avi’ you’d use this command:<br />
<a href="Screen" class="uri">Screen</a>(‘SetVideoCaptureParameter’, grabber, ‘SetNewMoviename=foo.avi’);</p>
<p>If you want to use the default codec(s) with their default settings,<br />
simply omit the parameter string. Psychtoolbox has a list of codecs that<br />
it tries to use for video and audio encoding, together with reasonable<br />
default parameters. It works its way down the list, starting with the most<br />
suitable/efficient codec, until it finds a codec that is supported on<br />
your system. Not all codecs may be installed by default on your operating<br />
system. Especially proprietary, non-free, or patent-encumbered codecs may<br />
not be installed on your system. You may have to select them explicitely<br />
in the software center of your distribution (see “help [<a href="GStreamer" class="uri">GStreamer</a>][(GStreamer)]((GStreamer))”).</p>
<p>If you only want to specify settings for the automatically chosen default<br />
codec, start the parameter string with ‘:<a href="CodecSettings" class="uri">CodecSettings</a>=’, followed by<br />
parameters.</p>
<p>If you want to chose a specific codec and (optionally) its settings,<br />
start the parameter string with ‘:<a href="CodecType" class="uri">CodecType</a>=’, followed by the settings.</p>
<p>Some video codecs are supported by our automatic setup code. These will<br />
automatically select matching audio codecs and audio-video multiplexers<br />
and reasonable default settings, so they are convenient for you to use:</p>
<p>x264enc: A highly optimized H264 video encoder, automatically combined with the<br />
faacenc or ffenc_aac MPEG-4 AAC audio encoder and an AVI file<br />
multiplexer or Quicktime mov file multiplexer.</p>
<p>xvidenc: The <a href="XVid" class="uri">XVid</a> MPEG-4 video encoder + AAC audio in a AVI file.</p>
<p>ffenc_mpeg4: Another MPEG-4 video encoder + AAC audio in a AVI file.</p>
<p>theoraenc: The Ogg Theora video encoder with Ogg Vorbis audio encoder and<br />
Ogg file format multiplexer (.ogv files).</p>
<p>vp8enc_webm: The VP-8 video codec with Ogg Vorbis audio in a WEBM (.webm)<br />
video container (HTML-5 video).</p>
<p>vp8enc_matroska: As above, but in a matroska file container.</p>
<p>ffenc_h263p: H.263 video encoder with AAC audio in a Quicktime container.</p>
<p>yuvraw: Raw, uncompressed YUV video data with AAC audio in a avi container.</p>
<p>huffyuv: Huffman encoded YUV raw video data + AAC audio in a<br />
matroska container. This is a lossless video codec, but<br />
it creates relatively large files.</p>
<p>ffenc_sgi: Stores video as a sequence of RLE compressed, lossless<br />
encoded SGI image files. This format usually can only be<br />
read and played back by Psychtoolbox itself and some<br />
specialized tools. It also creates relatively large<br />
files.</p>
<p>The huffyuv and ffenc_sgi encoders are mostly useful if you need<br />
bit-exact image storage or storage of raw video sensor data (Bayer color<br />
filter format), or of high bit depths video data, ie., with more than 8<br />
bpc. For most common use cases you can achieve qualitatively good enough<br />
results at much smaller file sizes with the standard lossy codecs.</p>
<p>Psychtoolbox supports high-level settings, which are relatively easy to<br />
use and understand. We describe these first. Psychtoolbox also supports<br />
low-level tweaking of codec specific settings, which require significant<br />
knowledge about video and audio encoding and lots of tinkering, but<br />
provide fine grained control over every tiny aspect of the recording<br />
process.</p>
<p>High level settings are not specific to a movie file format or choice of<br />
codec. All settings are accepted for all formats and codecs and mapped to<br />
corresponding format and codec specific low level settings, or they are<br />
silently ignored if a specific file/codec combination doesn’t support a<br />
high level setting. These settings are the most frequently choosed<br />
settings.</p>
<p>High level settings are specified as Keyword=value pairs, without a blank<br />
between the Keyword= and the value, and the first letter of the Keyword<br />
being a capital letter.</p>
<p>E.g.: ‘:<a href="CodecSettings" class="uri">CodecSettings</a>= Keyframe=5 Videoquality=0.5’ would encode using<br />
the default video codec with a video encoding quality of 0.5 aka 50% and<br />
a keyframe distance of maximum 5 frames.</p>
<p>‘:<a href="CodecType" class="uri">CodecType</a>=xvidenc Keyframe=10 Videobitrate=1000’ would choose the<br />
“xvidenc” <a href="XVid" class="uri">XVid</a> video codec with a keyframe interval of 10 frames and a<br />
average video bitrate of 1000 kilobits/sec.</p>
<h3 id="the-following-high-level-parameters-are-supported">The following high level parameters are supported:</h3>
<h1 id="video-encoding-settings">Video encoding settings</h1>
<p>Interlaced=0/1 - Tell codec if input video material is interlaced. This<br />
allows to optimize encoding further for smaller file size<br />
and better quality.</p>
<p>Keyframe=x - Set the maximum keyframe interval to at most ‘x’ frames.<br />
Most video players can only seek/navigate in a video with<br />
keyframe granularity. E.g., a keyframe setting of 10 would<br />
mean that one can only move forward/backward or address a<br />
specific target video frame with a stepsize or accuracy of<br />
10 frames. Lower numbers mean better navigation accuracy,<br />
with 1 providing frame accurate positioning, and possibly<br />
higher quality, but bigger video file sizes and potentially<br />
higher computational load. If omitted, the codec selects<br />
keyframe distances automatically, possibly dynamically,<br />
depending on visual scene content.</p>
<p>Videobitrate=x kb/s - Select video bit rate in kilobits per second. A direct<br />
control of the tradeoff filesize vs. quality. Bigger<br />
numbers mean higher quality and larger files. Codecs<br />
interpret this number as target average rate or maximum<br />
rate, depending on codec. Many codecs select this<br />
parameter dynamically (variable bitrate coding VBR).</p>
<p>Videoquality=x - A value between 0.0 and 1.0 to select target video quality<br />
between 0% and 100%. This controls different aspects of the<br />
encoding process, but bigger values mean higher quality and<br />
sometimes bigger filesize and sometimes higher cpu processor<br />
load during recording. If you have a slow computer and a<br />
demanding video format (high resolution, high framerate) you<br />
may need to lower video quality, so your poor machine can<br />
cope.</p>
<p>Profile=x - A value selecting the video encoding profile, where this is applicable.<br />
Currently only the H264 encoder supports this setting and provides the<br />
following profiles to select from:</p>
<pre><code>        0 = Baseline constrained profile.  
        1 = Baseline profile.  
        2 = Main profile.  
        3 = High profile.  
        4 = High profile with 10 bpc support.  
        5 = High profile with YUV 4:2:2 sampling.  
        6 = High profile with YUV 4:4:4 full resolution sampling.  
        7 = High profile with 10 bpc support. Intra frame only.  
        8 = High profile with YUV 4:2:2 sampling. Intra frame only.  
        9 = High profile with YUV 4:4:4 full resolution sampling. Intra frame only.  

        Note that not all values may be supported on your system, esp. the 10 bpc  
        profiles may not be supported by current PTB + [[GStreamer](GStreamer)][(GStreamer)]((GStreamer)) versions.  

        Note that deficient video software like Apples Quicktime player may  
        only be able to play back movie files encoded in Baseline and maybe Main  
        profile, ie., for profile values 0, 1, and maybe 2.  

        If Profile isn&#39;t specified, the default will be High profile, ie., it will  
        play back at high quality on good playback software like Psychtoolbox movie  
        playback engine, or with VLC and many other open-source playback applications,  
        but it won&#39;t play back with Apples Quicktime player.  </code></pre>
<h1 id="audio-encoding-settings">Audio encoding settings</h1>
<p>Audioquality=x - See Videoquality, this time for the audio encoding.</p>
<p>Audiobitrate=x kb/s - See Videobitrate, this time for the audio encoding.</p>
<h1 id="multiplexer-file-format-settings">Multiplexer / File format settings</h1>
<p>Timeresolution=x - How fine should time be resolved in the recorded footage?<br />
A value of x means to divide 1 second into x units, i.e.,<br />
provide a time granularity of 1/x th of a second. This<br />
influences file size, accuracy of time based navigation in<br />
the video, possibly the accuracy of returned movie presentation<br />
timestamps and of audio-video sync. If omitted, defaults to<br />
1/1000 th second aka 1 msec granularity.</p>
<p>Faststart=0/1 - If set to 1, optimize recorded files for a fast load and start<br />
of playback in players. This is usually what you want, so it is<br />
on by default.</p>
<p>Bigfiles=0/1 - If set to 1, allow recording of movie files with a size greater<br />
than 2 GB. This is usually what you want, but it may cause<br />
compatibility problems with playback software which can’t handle<br />
the “big file” file format.</p>
<h1 id="specifying-low-level-settings">Specifying low-level settings</h1>
<p>For more control you can also specify the various codec types and their<br />
low level settings in the syntax of the “gst-launch” [<a href="GStreamer" class="uri">GStreamer</a>][(GStreamer)]((GStreamer)) command<br />
line utility. This disables use of the high-level settings and provides<br />
full control:</p>
<p>A video codec type and settings string is prefixed with: ‘VideoCodec=’<br />
followed by codec name and settings, postfixed with ‘:::’, e.g.,<br />
‘VideoCodec=x264enc speed-preset=1 noise-reduction=100000 :::’.</p>
<p>A audio codec type and settings follows the same logic, with the<br />
‘AudioCodec=’ prefix, e.g., ‘AudioCodec=faac :::’</p>
<p>A multiplexer is chosen via the ‘Muxer=’ prefix, but no low-level<br />
settings can be passed to the multiplexer, only high-level settings as<br />
described above.</p>
<p>A specific (non-auto-selected) audio source and its settings can be<br />
chosen via the ‘AudioSource=’ prefix, e.g., ‘AudioSource=pulsesrc :::’ to<br />
select an audio input provided by the <a href="PulseAudio" class="uri">PulseAudio</a> sound server explicitely.</p>
<p>A full example string to select codecs and other low level settings would<br />
look like this:<br />
‘:<a href="CodecType" class="uri">CodecType</a>=<a href="VideoCodec" class="uri">VideoCodec</a>=x264enc speed-preset=1 noise-reduction=100000 ::: <a href="AudioCodec" class="uri">AudioCodec</a>=faac ::: <a href="AudioSource" class="uri">AudioSource</a>=pulsesrc ::: Muxer=avimux’</p>
<p>Intermixing of high-level and low-level settings is also possible:<br />
‘:<a href="CodecType" class="uri">CodecType</a>=x264enc Keyframe=1 Videobitrate=8192 <a href="AudioCodec" class="uri">AudioCodec</a>=alawenc ::: <a href="AudioSource" class="uri">AudioSource</a>=pulsesrc ::: Muxer=qtmux’<br />
This would select the x264enc H264 video codec, with high level settings,<br />
and additionally choose (low-level) a specific audio codec, audio source<br />
and multiplexer.</p>
<p>You can find a list of supported codecs, sources and multiplexers by<br />
typing ‘gst-inspect’ in a Unix or Windows terminal window. You can<br />
list the available low-level settings (aka properties) via gst-inspect codecname.</p>
<p>E.g., to list all available low-level properties of the x264enc codec,<br />
you’d type “gst-inspect x264enc” in a terminal window.</p>
<p>Please note that if you don’t choose a Psychtoolbox supported video codec<br />
from the list provided above, then you will need to specify all audio<br />
codec and multiplexer settings manually, as Psychtoolbox doesn’t know<br />
which audio codecs or muxers to use with a video codec unknown to it.</p>
<div class="code_header" style="text-align:right;">
<p><span style="float:left;">Path  </span> <span class="counter">Retrieve <a href=
  "https://raw.github.com/Psychtoolbox-3/Psychtoolbox-3/beta/Psychtoolbox/PsychDocumentation/VideoRecording.m">current version from GitHub</a> | View <a href=
  "https://github.com/Psychtoolbox-3/Psychtoolbox-3/commits/beta/Psychtoolbox/PsychDocumentation/VideoRecording.m">changelog</a></span></p>
</div>
<div class="code">
<p><code>Psychtoolbox/PsychDocumentation/VideoRecording.m</code></p>
</div>

<h2 id="psychtoolbox-psychhardware">[[Psychtoolbox]] › [[PsychHardware]]</h2>
<p><a href="PsychPowerMate" class="uri">PsychPowerMate</a> - A driver for the Griffin Technology <a href="PowerMate" class="uri">PowerMate</a> USB knob.</p>
<h3 id="note">Note:</h3>
<p>This driver is currently only for the <a href="PowerMate" class="uri">PowerMate</a> USB edition, not for the<br />
bluetooth product. It best supports modern Linux systems, e.g.,<br />
Ubuntu 14.04.2 LTS or later, Debian-8 or later, or other similar modern<br />
systems with version 2.9.0 or later of the “evdev” X11 input driver.</p>
<p>Support on Apple OSX and Microsoft Windows is much more limited. Expect<br />
worse reliability, higher cpu load, higher latencies, less accurate<br />
timing. While on Linux, the current driver can internally record up to<br />
104 full knob rotations by default, or an unlimited number with suitable<br />
options set, without losing information, the Windows variant can at most<br />
record 5 rotations, and the OSX driver will probably not even manage to<br />
record one full rotation. To avoid loss of position data, you will need<br />
to call <a href="PsychPowerMate" class="uri">PsychPowerMate</a>(‘Get’) frequently on OSX and Windows, even if you<br />
do not need the information at that moment.</p>
<p>On Windows, setting LED brightness does not work.</p>
<h1 id="linux-setup">Linux setup:</h1>
<p>You must install a specific xorg input configuration file for the <a href="PowerMate" class="uri">PowerMate</a><br />
to be recognized. In a terminal window do:</p>
<ol type="1">
<li>cd into the Psychtoolbox working directory (output of <a href="PsychtoolboxRoot">PsychtoolboxRoot)</a>)<br />
</li>
<li>sudo cp <a href="PsychHardware" class="uri">PsychHardware</a>/50-evdev-powermate.conf /usr/share/X11/xorg.conf.d/<br />
</li>
<li>Logout and login again.</li>
</ol>
<h1 id="interesting-technical-background-info">Interesting technical background info:</h1>
<p>Technical background info, copied from the Linux powermate.c device driver,<br />
written by William R Sowerbutts, the author of the Linux driver:</p>
<p>“Testing with the knob I have has shown that it measures approximately 94”clicks&quot;<br />
for one full rotation. Testing with my High Speed Rotation Actuator (ok, it was<br />
a variable speed cordless electric drill) has shown that the device can measure<br />
speeds of up to 7 clicks either clockwise or anticlockwise between pollings from<br />
the host. If it counts more than 7 clicks before it is polled, it will wrap back<br />
to zero and start counting again. This was at quite high speed, however, almost<br />
certainly faster than the human hand could turn it. Griffin say that it loses a<br />
pulse or two on a direction change; the granularity is so fine that I never<br />
noticed this in practice.&quot;</p>
<ul>
<li><p>The rotary resolution is therefore about 3.8298 degrees per “click” or unit.</p></li>
<li><p>The <a href="PowerMate" class="uri">PowerMate</a> can lose a click or two on a direction change, therefore can<br />
accumulate rotational error on each turn direction change.</p></li>
<li><p>The <a href="PowerMate" class="uri">PowerMate</a> wants to be sampled at 10 msec intervals according to its<br />
USB HID descriptor. Low-speed USB interrupt endpoint sampling interval<br />
duration must be a power of two, so it will actually get sampled at<br />
8 msec intervals, for a maximum update rate of 125 Hz.</p></li>
</ul>
<h3 id="commands">Commands:</h3>
<p>deviceIds = <a href="PsychPowerMate" class="uri">PsychPowerMate</a>(‘List’);<br />
– Return a list of all ‘deviceIds’ of all connected <a href="PowerMates" class="uri">PowerMates</a>. Items from<br />
this list can be passed as ‘deviceId’ parameter to the ‘Open’ function to<br />
select a specific <a href="PowerMate" class="uri">PowerMate</a>. Please note that the <a href="PowerMates" class="uri">PowerMates</a> themselves do<br />
not provide any identifying information, like a serial number, so the computer<br />
can’t distinguish them. The ‘deviceIds’ you get back from this function are<br />
therefore only guaranteed to be valid during a given session. Unplugging and<br />
replugging <a href="PowerMates" class="uri">PowerMates</a> may change the ids assigned to them, based on operating<br />
system specific criteria. On MS-Windows the deviceIds don’t change even<br />
if you plug the <a href="PowerMate" class="uri">PowerMate</a> into a different USB port, so this function may<br />
be useless for device selection and you may have to figure out something<br />
specific to your computer hardware setup. On Linux you can assign fixed<br />
ids to fixed USB ports. See the Technical note at the end of this help<br />
text for how to do it. On OSX the deviceIds seem to be associated with<br />
fixed USB ports, with numbers at least persistent during a session.</p>
<p>handle = <a href="PsychPowerMate" class="uri">PsychPowerMate</a>(‘Open’ [, deviceId][, historySize=10000])<br />
– Open a connected Griffin <a href="PowerMate" class="uri">PowerMate</a>, return a handle to it.</p>
<p>The optional ‘deviceId’ selects which of multiple connected <a href="PowerMates" class="uri">PowerMates</a> should<br />
be used. <a href="PsychPowerMate" class="uri">PsychPowerMate</a>(‘List’) returns a list of all possible ‘deviceId’s.<br />
If ’deviceId’ is omitted then the first found <a href="PowerMate" class="uri">PowerMate</a> is opened.</p>
<h3 id="linux-only">Linux only:</h3>
<p>The optional ‘historySize’ parameter allows to select how many events the<br />
knob press and motion history functions ‘StartHistory’ and ‘GetHistory’ can<br />
collect in the background. It defaults to 10000 events if omitted, ie. up to<br />
5000 knob presses + releases, or alternatively about 104 full knob rotations<br />
can be recorded in the background before you either need to get the recorded<br />
data via the ‘GetHistory’ subfunction to empty the internal storage, or the<br />
internal storage will be full and stop collecting new data.</p>
<p>If you need to record more than 10000 such events in total, just specify a<br />
larger ‘historySize’: Each button press or release creates 2 events (1 press +<br />
1 release). Each turn of the knob by 1 unit (about 3.8 degrees) creates one<br />
event.</p>
<p><a href="PsychPowerMate" class="uri">PsychPowerMate</a>(‘<a href="Close" class="uri">Close</a>’, handle);<br />
– <a href="Close" class="uri">Close</a> previously opened <a href="PowerMate" class="uri">PowerMate</a> specified by ‘handle’.</p>
<p><a href="PsychPowerMate" class="uri">PsychPowerMate</a>(‘SetBrightness’, handle, level);<br />
– Change brightness of the LED of the <a href="PowerMate" class="uri">PowerMate</a> specified by ‘handle’<br />
to ‘level’. Level can be between 0 and 255. Note: This does not currently<br />
work on MS-Windows.</p>
<p>Note: Currently ‘handle’ is ignored, so you can not select which one<br />
of multiple PowerMate’s would get its brightness set and this only<br />
works reliably for a single <a href="PowerMate" class="uri">PowerMate</a>.</p>
<p>[button, dialPos] = <a href="PsychPowerMate" class="uri">PsychPowerMate</a>(‘Get’, handle);<br />
– Poll the <a href="PowerMate" class="uri">PowerMate</a> specified by ‘handle’, return the status<br />
of its ‘button’ 1 = Pressed, 0 = Released. Also return the current<br />
‘dialPos’ dial position of its dial - its turning knob. Please note<br />
that the knob does not have a defined zero position. You can turn it<br />
endlessly in one direction. Turning in one direction will simply<br />
increment the ‘dialPos’ position, turning into the other direction<br />
will decrement it. See above comments on the accuracy and resolution<br />
of position reporting.</p>
<p>secs = <a href="PsychPowerMate" class="uri">PsychPowerMate</a>(‘WaitButton’, handle [, waitforbuttonpress=1][, untilTime=inf]);<br />
– Wait for button press or release on the <a href="PowerMate" class="uri">PowerMate</a> specified by ‘handle’,<br />
return the <a href="GetSecs" class="uri">GetSecs</a>() time of press in ‘secs’.</p>
<p>If the optional ‘waitforbuttonpress’ flag is set to 0 then the function<br />
waits for a button release, otherwise it waits for a button press.</p>
<p>If the optional ‘untilTime’ parameter is given, the function times out<br />
at time ‘untilTime’, otherwise it waits forever if nobody presses or releases<br />
the button.</p>
<p>secs = <a href="PsychPowerMate" class="uri">PsychPowerMate</a>(‘WaitRotate’, handle [, untilTime=inf]);<br />
– Wait for knob rotation on the <a href="PowerMate" class="uri">PowerMate</a> specified by ‘handle’,<br />
return the <a href="GetSecs" class="uri">GetSecs</a>() time of rotation in ‘secs’.</p>
<p>If the optional ‘untilTime’ parameter is given, the function times out<br />
at time ‘untilTime’, otherwise it waits forever if nobody moves the knob.</p>
<h1 id="the-following-functions-are-only-supported-on-linux">The following functions are only supported on Linux</h1>
<p><a href="PsychPowerMate" class="uri">PsychPowerMate</a>(‘StartHistory’, handle [, clearHistory=0]);<br />
– Start recording of a knob press and knob motion history in the background.<br />
If the optional ‘clearHistory’ flag is set to 1 then the current history is<br />
cleared/discarded before start of recording of a new one.</p>
<p><a href="PsychPowerMate" class="uri">PsychPowerMate</a>(‘StopHistory’, handle);<br />
– Stop recording of knob press and knob motion history.<br />
You can resume recording via ‘StartHistory’ or start recording a new one,<br />
discarding old data via ‘StartHistory’ with the flag clearHistory=1 set.</p>
<p>history = <a href="PsychPowerMate" class="uri">PsychPowerMate</a>(‘GetHistory’, handle);<br />
– Retrieve currently recorded knob press and knob motion history.<br />
history is a 4-by-n matrix with n columns for n recorded events.<br />
Row 1 contains knob position. Row 2 contains knob button state: 0 = Released,<br />
1 = Pressed. Row 3 contains a <a href="GetSecs" class="uri">GetSecs</a> timestamp of the element. Row 4 tells<br />
if the given column records a knob press/release (0) or a knob movement (1).</p>
<p>numItems = <a href="PsychPowerMate" class="uri">PsychPowerMate</a>(‘GetHistorySize’, handle);<br />
– Return number of items currently recorded in history.</p>
<p>Technical note: How to map physical USB bus location to a /dev/input/powermateXX<br />
symlink via a udev rule, then how to map that device file to a xinput device<br />
name for enumeration/selection by our driver. Follow the approach outlined<br />
at the bottom of this thread for dual-touchscreen setups with identical touchscreen:</p>
<p>http://arstechnica.com/civis/viewtopic.php?f=16&amp;t=1146846</p>
<div class="code_header" style="text-align:right;">
<p><span style="float:left;">Path  </span> <span class="counter">Retrieve <a href=
  "https://raw.github.com/Psychtoolbox-3/Psychtoolbox-3/beta/Psychtoolbox/PsychHardware/PsychPowerMate.m">current version from GitHub</a> | View <a href=
  "https://github.com/Psychtoolbox-3/Psychtoolbox-3/commits/beta/Psychtoolbox/PsychHardware/PsychPowerMate.m">changelog</a></span></p>
</div>
<div class="code">
<p><code>Psychtoolbox/PsychHardware/PsychPowerMate.m</code></p>
</div>

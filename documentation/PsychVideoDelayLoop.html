<h2 id="psychtoolbox-psychvideocapture">[[Psychtoolbox]] › [[PsychVideoCapture]]</h2>
<p><a href="PsychVideoDelayLoop" class="uri">PsychVideoDelayLoop</a>(subcommand, arg1, arg2, …)</p>
<p>This implements a realtime video feedback loop with adjustable<br />
delay, e.g., for action-perception studies.</p>
<p>Arguments:<br />
subcommand - Is a string containing the subcommand to call.<br />
arg1, … argn - Are the arguments that the specific subcommand<br />
requires.</p>
<h3 id="subcommands-their-meaning-and-arguments">Subcommands, their meaning and arguments:</h3>
<p><a href="PsychVideoDelayLoop" class="uri">PsychVideoDelayLoop</a>(‘Verbosity’, level);<br />
– Set level of verbosity: 0 == Shut up. 1 == Errors and warnings.<br />
2 == Information as well. The default is 1.</p>
<p>handle = <a href="PsychVideoDelayLoop" class="uri">PsychVideoDelayLoop</a>(‘Open’, windowPtr [,deviceId] [,ROI] [,inColor])<br />
– Open a video capture device ‘deviceId’ for use on a specific onscreen<br />
window ‘windowPtr’, setup region of interest ‘ROI’, select if capture<br />
should happen ‘inColor’ = 1 or gray-scale (inColor = 0).<br />
This returns a ‘handle’ for the device, so other scripts can do<br />
device specific setup.</p>
<p><a href="PsychVideoDelayLoop" class="uri">PsychVideoDelayLoop</a>(‘<a href="Close" class="uri">Close</a>’)<br />
– Shutdown, close and release all video capture devices. This<br />
invalidates any handle obtained from ‘Open’.</p>
<p>fps = <a href="PsychVideoDelayLoop" class="uri">PsychVideoDelayLoop</a>(‘TuneVideoRefresh’, capturerate)<br />
– Measure the exact capture rate of the video device when<br />
requesting a capturerate of ‘capturerate’, check if the displays<br />
refresh rate is roughly compatible with the capture device setting<br />
and then try to fine-tune the display refresh rate in order to<br />
minimize phase-shifts between capture device work-cycle and display<br />
device work-cycle. Return the final fine-tuned and measured framerate<br />
‘fps’ of the display device.<br />
Note: Fine-tuning is only possible in a very narrow range (+/- 1Hz)<br />
around the display refresh rate set in your display settings. This<br />
feature is currently only supported on GNU/Linux.</p>
<p><a href="PsychVideoDelayLoop" class="uri">PsychVideoDelayLoop</a>(‘SetAbortKeys’, keyarray)<br />
– Define a sequence of keycodes for valid abort<br />
keys. If any of the keys given in the sequence is pressed, the<br />
video loop will exit. You can map keys to keycodes via <a href="KbName" class="uri">KbName</a>, e.g.,<br />
key1 = <a href="KbName" class="uri">KbName</a>(‘Escape’); key2 = <a href="KbName" class="uri">KbName</a>(‘Space’); keyarray = [key1 key2];<br />
–&gt; Create a keyarray that would abort on Escape- or Space- keypress.</p>
<p><a href="PsychVideoDelayLoop" class="uri">PsychVideoDelayLoop</a>(‘SetAbortTimeout’, timeout)<br />
– Define a maximum duration of the feedback loop in seconds. After<br />
that amount of time has elapsed, the loop will exit.</p>
<p><a href="PsychVideoDelayLoop" class="uri">PsychVideoDelayLoop</a>(‘SetHeadstart’, timemargin)<br />
– Define an estimate of how long the system will take to process a<br />
new video frame plus the expected drift during one trial. The loop<br />
will take this extra amount of time into account when prestarting the<br />
camera to make sure that the excess latency caused by the video loop itself<br />
is as short and stable as possible. E.g., a value of 0.004 secs for<br />
processing overhead + maybe 0.004 secs for drift == 0.008 secs could<br />
be reasonable for an otherwise well synchronized system.</p>
<p><a href="PsychVideoDelayLoop" class="uri">PsychVideoDelayLoop</a>(‘SetPresentation’, fullfov, mirrored, upsidedown);<br />
– Change mode of presentation: fullfov=0 Show centered image, fullfov=1<br />
Zoom image to fill full area of onscreen window. mirrored=0 Normal<br />
presentation, mirrored=1 Mirror left-right. upsidedown=0 Upright,<br />
upsidedown=1 Upside-Down.</p>
<p><a href="PsychVideoDelayLoop" class="uri">PsychVideoDelayLoop</a>(‘SetLogging’, mode, maxseconds)<br />
– Disable (mode=0) or enable (mode=1) logging of timestamps.<br />
‘maxseconds’ is the number of seconds for which the arrays should<br />
be pre-allocated. After running the delay loop you can query the<br />
logged timestamps via the ‘GetLog’ subfunction.</p>
<p>log = <a href="PsychVideoDelayLoop" class="uri">PsychVideoDelayLoop</a>(‘GetLog’)<br />
– Return the timing logs of last loop run. This is a 3 rows by<br />
n columns matrix, where each column corresponds to the timing<br />
samples of one frame: log(1,i) = Absolute system time in seconds,<br />
when frame i was captured. log(2,i) = Delta (seconds) between<br />
capture and visual onset of image i on screen. log(3,i) contains<br />
an estimate of the full delay between capture onset of frame i and<br />
visual onset. It is the value log(2,i) + estimated latency between<br />
start of camera sensor exposure and transmit completion for the frame.<br />
The accuracy of this estimate should be pretty good for cameras known<br />
to Psychtoolbox and it is a *guess* for the lower bound on the real<br />
latency on unknown cameras.</p>
<p><a href="PsychVideoDelayLoop" class="uri">PsychVideoDelayLoop</a>(‘RecordFrames’, framestep)<br />
– Record every ‘framestep’th frame in system RAM as an <a href="OpenGL" class="uri">OpenGL</a><br />
texture. The video loop doesn’t discard every texture after drawing<br />
it, but enqueues it an a system RAM buffer. The vector of texture<br />
handles can be retrieved via ’GetRecordedFrames’ after the loop<br />
has finished. Default is zero == Recording disabled. A value of<br />
one records every frame, a value of two every second, …</p>
<p>Calling this function will also reset the vector of recorded frames<br />
to empty, but it will not delete the textures! That is your task.</p>
<p>texids = <a href="PsychVideoDelayLoop" class="uri">PsychVideoDelayLoop</a>(‘GetRecordedFrames’)<br />
Return vector of texture handles for all recorded frames.<br />
texids(1,i) contains the texture handle for the i’th recorded frame.<br />
texids(2,i) contains the onset timestamp for the i’th recorded frame.</p>
<p><a href="PsychVideoDelayLoop" class="uri">PsychVideoDelayLoop</a>(‘RunLoop’, delayFrames[, onlinecontrol]);<br />
– Run the video feedback loop, using the parameters specified above.<br />
The video loop will start and run until one of the abort keys is pressed,<br />
or the timeout is reached. It will log timestamps as requested. Each<br />
captured video frame is output again after ‘delayFrames’ capture cycle<br />
durations, e.g., capturerate = 30 fps -&gt; cycle = 1/30 sec = 33.33 ms –&gt;<br />
delay is at least delayFrames * 33.33 ms. Images are drawn and shown<br />
in sync with vertical retrace after that amount of time. The real onset<br />
time obviously depends on the monitor refresh interval and phase between<br />
camera and monitor.</p>
<p>If ‘onlinecontrol’ is set to 1, then a few control keys are enabled to<br />
allow for interactive change of settings like brightness, gain and<br />
exposure time: ‘b’ increases brightness, ‘d’ decreases brightness.<br />
Up/<a href="DownArrow" class="uri">DownArrow</a> keys increase/decrease gain. Right/<a href="LeftArrow" class="uri">LeftArrow</a> keys<br />
increase/decrease exposure time (shutter time).</p>
<div class="code_header" style="text-align:right;">
<p><span style="float:left;">Path  </span> <span class="counter">Retrieve <a href=
  "https://raw.github.com/Psychtoolbox-3/Psychtoolbox-3/beta/Psychtoolbox/PsychVideoCapture/PsychVideoDelayLoop.m">current version from GitHub</a> | View <a href=
  "https://github.com/Psychtoolbox-3/Psychtoolbox-3/commits/beta/Psychtoolbox/PsychVideoCapture/PsychVideoDelayLoop.m">changelog</a></span></p>
</div>
<div class="code">
<p><code>Psychtoolbox/PsychVideoCapture/PsychVideoDelayLoop.m</code></p>
</div>

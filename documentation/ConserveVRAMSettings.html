<h2 id="psychtoolbox-psychdocumentation">[[Psychtoolbox]] › [[PsychDocumentation]]</h2>
<p><a href="ConserveVRAMSettings" class="uri">ConserveVRAMSettings</a>: Workaround for flawed hardware and drivers</p>
<p>The command <a href="Screen" class="uri">Screen</a>(‘<a href="Preference" class="uri">Preference</a>’, ‘ConserveVRAM’, mode); can be used to<br />
enable a couple of special work-arounds inside <a href="Screen" class="uri">Screen</a> to work around<br />
broken operating systems, graphics drivers or graphics hardware, or to<br />
work around ressource limitations of graphics hardware.</p>
<p>You define the requested workaround by setting the parameter ‘mode’ to a<br />
sum of the following values:</p>
<h3 id="allowed-summands-flags-for-mode-and-their-effect">Allowed summands (flags) for ‘mode’ and their effect:</h3>
<p>1 == kPsychDisableAUXBuffers: A setting of 1 asks Psychtoolbox to not<br />
allocate any <a href="OpenGL" class="uri">OpenGL</a> <a href="AUXiliary" class="uri">AUXiliary</a> buffers when opening a new onscreen window.<br />
AUX buffers are only needed if you want to run the <a href="Screen" class="uri">Screen</a>(‘<a href="Flip" class="uri">Flip</a>’) command<br />
with the optional argument ‘dontclear = 1’ and you are not using the<br />
imaging pipeline, or if you want to use stereomode 2 or 3 without using<br />
the imaging pipeline. If you do use the imaging pipeline or don’t use any<br />
of the above, there’s no need for AUX buffers.</p>
<p>This setting is mostly meant to save a bit of VRAM on graphics hardware<br />
that only has very small amounts of VRAM, e.g., only 16 MB or 8 MB VRAM.</p>
<p>2 == kPsychDontCacheTextures: A setting of 2 asks Psychtoolbox not to<br />
cache used textures in the graphics hardware local VRAM memory. This will<br />
save some VRAM memory at the expense of lower drawing performance. Only<br />
useful on gfx-hardware with low amounts of VRAM and only works on<br />
<a href="MacOS" class="uri">MacOS</a>/X. The flag is silently ignored on Windows and Linux.</p>
<p>4 == kPsychOverrideWglChoosePixelformat: This is a workaround for broken<br />
MS-Windows graphics drivers: <a href="Ask" class="uri">Ask</a> <a href="Screen" class="uri">Screen</a> to not use the<br />
wglChoosePixelFormat() command when creating a new onscreen window. This<br />
can prevent crashes on such broken setups, but it will disable <a href="OpenGL" class="uri">OpenGL</a><br />
multisampling for anti-aliasing, ie., the ‘multisample’ parameter of<br />
<a href="Screen" class="uri">Screen</a>(‘OpenWindow’) will be ignored. In the future, other special<br />
capabilities will be disabled as well.</p>
<p>8 == kPsychDisableContextIsolation: This is a workaround for broken<br />
MS-Windows graphics drivers: Do not create separate isolated <a href="OpenGL" class="uri">OpenGL</a><br />
rendering contexts for <a href="Screen" class="uri">Screen</a> and MOGL when using low level <a href="OpenGL" class="uri">OpenGL</a> 3D<br />
graphics commands with <a href="OpenGL" class="uri">OpenGL</a> for Matlab. This prevents crashes on broken<br />
setups, but debugging of your own 3D code may become much harder. Its<br />
better to upgrade to the latest fixed drivers.<br />
Before you try this setting 8, first try if the setting 256 (see below)<br />
fixes the problem for you. That is a softer approach - If it works for<br />
you then you won’t lose any important functionality!</p>
<p>16 == kPsychDontAttachStencilToFBO: Do not attach stencil buffer<br />
attachments to <a href="OpenGL" class="uri">OpenGL</a> framebuffer objects when using <a href="OpenGL" class="uri">OpenGL</a> 3D graphics<br />
in conjunction with the Psychtoolbox imaging pipeline. This is again a<br />
workaround for some broken MS-Windows graphics drivers to make the 3D +<br />
imaging combo work at least when no stencil buffer is needed.</p>
<p>32 == kPsychDontShareContextRessources: Do not share ressources between<br />
different onscreen windows. Usually you want PTB to share all ressources<br />
like offscreen windows, textures and GLSL shaders among all open onscreen<br />
windows. If that causes trouble for some weird reason, you can prevent<br />
automatic sharing with this flag.</p>
<p>64 == kPsychUseSoftwareRenderer: Request use of a software implemented<br />
renderer instead of the GPU hardware renderer. This request is silently<br />
ignored if your platform doesn’t support software rendering. Currently<br />
only <a href="MacOS" class="uri">MacOS</a>/X 10.4 and later in windowed mode (i.e. not fullscreen)<br />
supports this via the Apple floating point renderer. Mostly useful for<br />
testing and debugging of scripts that need floating point support on<br />
hardware that doesn’t support this. Not generally useful for production<br />
use.</p>
<p>On MS-Windows this allows to use the Microsoft GDI software renderer,<br />
ie., to not abort if that renderer is detected. Normally <a href="Screen" class="uri">Screen</a>() would<br />
abort when detecting the GDI renderer.</p>
<p>On GNU/Linux this allows to use the Mesa X11 software renderer, ie.,<br />
to not abort if that renderer is detected. Normally <a href="Screen" class="uri">Screen</a>() would<br />
abort when detecting that renderer.</p>
<p>128 == kPsychEnforceForegroundWindow: Request application of the Windows<br />
GDI calls <a href="SetForegroundWindow" class="uri">SetForegroundWindow</a>() and <a href="SetFocus" class="uri">SetFocus</a>() on each created onscreen<br />
window on MS-Windows. This may improve reliability of onscreen windows<br />
staying in front of all other windows, but is incompatible with the use<br />
of <a href="GetChar" class="uri">GetChar</a>, <a href="CharAvail" class="uri">CharAvail</a> and <a href="ListenChar" class="uri">ListenChar</a>, so it must be requested with this<br />
flag. These calls are unfortunately absolutely crucial on MS-Vista and<br />
later operating systems to guarantee artifact free (tear-free) and timing<br />
accurate stimulus onset and robust and accurate stimulus onset<br />
timestamping. Therefore they are automatically applied to all fullscreen<br />
windows on Windows Vista and later operating systems. See the option<br />
kPsychPreventForegroundWindow to forcefully disable/prevent use of these<br />
options, if use of <a href="GetChar" class="uri">GetChar</a>() et al. is more important than artifact free<br />
stimulus presentation.</p>
<p>256 == kPsychUseWindowsContextSharingWorkaround1<br />
On MS-Windows, skip a few not too essential setup steps when creating a<br />
userspace <a href="OpenGL" class="uri">OpenGL</a> rendering context for 3D mode. This is a “soft” version<br />
of kPsychDisableContextIsolation – Less intrusive as it doesn’t disable<br />
context isolation completely, but only a subset. May be able to<br />
work-around an <a href="NVidia" class="uri">NVidia</a> driver bug reported in March 2008 on <a href="GF8xxx" class="uri">GF8xxx</a> series.</p>
<p>512 == kPsychAvoidCPUGPUSync: Avoid any internal calls (if possible) that<br />
could cause a synchronization of the CPU and GPU. Synchronization is a<br />
potentially expensive operation that can degrade performance in certain<br />
circumstances. Its often needed for error checking. Setting this flag may<br />
give you a speedup on certain operations, but at the cost of reduced<br />
error checking and error handling: Error conditions detected otherwise<br />
may silently slip through and cause mysterious malfunctions or stimulus<br />
corruption without PTB noticing this or providing any troubleshooting<br />
tips. The usefulness of this flag highly depends on your graphics<br />
hardware, driver and operating system. It may give a large speedup, or no<br />
speedup at all, but it will always reduce robustness!</p>
<p>1024 == kPsychTextureUploadFormatOverride<br />
Tell PTB to use the opposite texture format of what its auto-detection<br />
thinks is optimal. <a href="Screen" class="uri">Screen</a> contains code to auto-detect certain type of<br />
graphics chips with broken drivers and tries to work-around them by<br />
chosing different parameters for fast texture creation in certains<br />
circumstances. In case those vendors should ever fix their drivers and<br />
thereby the built-in workaround becoming invalid, this allows to override<br />
PTB’s choice. This is mostly to work around broken ATI drivers on<br />
MS-Windows which cause miserable texture creation performance with the<br />
standard optimized settings.</p>
<p>2048 == kPsychAvoidFramebufferBlitIfPossible<br />
Tell PTB to not use the EXT_framebuffer_blit extension if a lower-speed<br />
workaround solution exists. This will mostly affect the operation of<br />
<a href="Screen" class="uri">Screen</a>(‘CopyWindow’) when the imaging pipeline is active. Normally a more<br />
flexible, capable, faster method would be used, unless you set this flag<br />
to fall back to the old solution.</p>
<p>4096 == kPsychUseBeampositionQueryWorkaround<br />
Tell PTB to always use the workaround for broken beamposition queries in<br />
VBL on MS-Windows, even if the automatic startup test does not detect any<br />
problems. This for rare cases where the test fails to detect broken<br />
setups.</p>
<p>8192 == kPsychUseAGLForFullscreenWindows<br />
Tell PTB on Mac OS/X to always use the Cocoa/<a href="NSOpenGL" class="uri">NSOpenGL</a> API for <a href="OpenGL" class="uri">OpenGL</a><br />
system setup, even if the requested onscreen window is a fullscreen<br />
window. Normally PTB would use the CGL API for fullscreen windows for<br />
higher efficiency. This setting is automatically implicitly applied if<br />
PTB is running on OSX version 10.8 “Mountain Lion” or later, to work<br />
around various hilarious graphics driver bugs.</p>
<p>16384 == kPsychUseCompositorForFullscreenWindows<br />
Tell PTB to use a compositing window manager for stimulus display if such<br />
a desktop compositor is supported on your operating system. Currently<br />
this flags affects operation on <a href="MacOS" class="uri">MacOS</a>/X and on Microsoft Windows Vista<br />
and later versions of Windows.</p>
<p>On Windows Vista and Windows-7, it will enforce use of the Windows Aero<br />
desktop compositor (aka DWM or Desktop Window Manager). Accuracy and<br />
reliability of visual stimulus onset timing and the accuracy and<br />
reliability of stimulus onset timestamps will be greatly reduced in this<br />
mode - up to the point of being completely useless for timed stimulus<br />
presentation. The mode may however be useful for debugging and code<br />
development as a convenience feature. By default, PTB disables the DWM as<br />
soon as a fullscreen window is opened, unless the<br />
<a href="PsychDebugWindowConfiguration" class="uri">PsychDebugWindowConfiguration</a>() function was used to switch to debug<br />
mode.</p>
<p>On Mac OS/X this will cause <a href="Screen" class="uri">Screen</a> to avoid capturing the display. This<br />
may or may not affect display performance, who knows?</p>
<p>32768 == kPsychBusyWaitForVBLBeforeBufferSwapRequest<br />
If <a href="Screen" class="uri">Screen</a>(‘<a href="Flip" class="uri">Flip</a>’) in sync with vertical retrace is requested and<br />
beamposition queries are supported, use a busy-waiting, high cpu load<br />
spin-wait loop to wait for onset of vertical blank interval (VBL) before<br />
submitting doublebuffer swaprequests to the GPU. This is meant as a<br />
last-ressort workaround for GPU’s with severely broken sync-to-VBL<br />
support. The only known current example is the Apple Leopard operatings<br />
system when used with <a href="NVidia" class="uri">NVidia</a> Geforce 8000 GPU’s or later in<br />
frame-sequential stereo mode. This will create a very high cpu load and<br />
may have negative side effects on system timing. Use as last resort!</p>
<p>65536 (= 2^16) == kPsychDontUseNativeBeamposQuery [Deprecated]<br />
Do not use operating system native beamposition queries, but try to use<br />
own mechanism, or none at all. This was used to work around bugs in OS<br />
native beamposition query mechanisms, e.g., Leopard 10.5.7 + ATI GPU’s.<br />
It has no function anymore under OSX as of Psychtoolbox 3.0.12.</p>
<p>131072 (= 2^17) == kPsychDisableAeroDWM [Deprecated]<br />
Disable the Aero DWM desktop composition manager on Windows Vista and<br />
later. By default, Psychtoolbox will do this anyway for fullscreen windows,<br />
as this provides better timing behaviour, so this flag is pretty pointless<br />
now. On Windows-8 and later, the DWM can not be disabled anymore anyway.</p>
<p>262144 (= 2^18) == kPsychPreventForegroundWindow [Deprecated]<br />
Prevent calls to the Windows GDI functions <a href="SetForegroundWindow" class="uri">SetForegroundWindow</a>() and<br />
<a href="SetFocus" class="uri">SetFocus</a>() on each created fullscreen onscreen window on MS-Windows.</p>
<p>524288 (= 2^19) == kPsychDisableOpenMLScheduling<br />
Disable use of <a href="OpenML" class="uri">OpenML</a> scheduling for <a href="Screen" class="uri">Screen</a>(‘<a href="Flip" class="uri">Flip</a>’) bufferswaps. <a href="OpenML" class="uri">OpenML</a><br />
is currently supported on some recent versions of GNU/Linux with certain<br />
graphics cards and drivers (e.g., Free graphics stack on Ubuntu 10.10 and<br />
later with modern Intel and ATI/AMD GPU’s and <a href="XOrg" class="uri">XOrg</a> Servers 1.8.2, 1.9.x and<br />
later, Linux kernel 2.6.35 and later). PTB will use <a href="OpenML" class="uri">OpenML</a> for scheduling<br />
and timestamping of visual stimulus onset if it detects a Linux system<br />
with support for <a href="OpenML" class="uri">OpenML</a>. The kPsychDisableOpenMLScheduling flag will<br />
forcefully disable use of <a href="OpenML" class="uri">OpenML</a>, e.g., for debugging/testing purpose.</p>
<p>1048576 (= 2^20) == kPsychBypassLUTFor10BitFramebuffer<br />
If a 30 bpp, 10 bpc native 10 bit framebuffer is requested and<br />
Psychtoolbox is executing on Linux (as superuser) or OS/X (with the<br />
<a href="PsychtoolboxKernelDriver" class="uri">PsychtoolboxKernelDriver</a> loaded), then apply the 10 bit LUT bypass enable<br />
hack even on graphics cards where this should not be required, e.g., on<br />
the <a href="FireGL" class="uri">FireGL</a> or <a href="FirePro" class="uri">FirePro</a> cards from ATI/AMD. This as a workaround for broken<br />
ATI/AMD graphics drivers which are able to configure a 10 bit framebuffer<br />
and scanout, but fail to setup the LUT’s properly.</p>
<p>2097152 (= 2^21) == kPsychEnforce10BitFramebufferHack<br />
Use 10 bpc framebuffer hack even if PTB thinks it is not needed or<br />
appropriate. This implies kPsychBypassLUTFor10BitFramebuffer, and the<br />
same conditions must be met for it to possibly work. This can be used to<br />
enforce 10 bpc mode on <a href="FireGL" class="uri">FireGL</a>/<a href="FirePro" class="uri">FirePro</a> GPU’s with broken drivers. It<br />
overrides all our safeguards and may end in a hard machine crash is used<br />
on the wrong setup. Try to use the regular way of enabling this in ATI’s<br />
Catalyst Control Center application if possible.</p>
<p>4194304 (= 2^22) == kPsychIgnoreNominalFramerate<br />
Do not use the nominal video refresh rate of a screen as reported by the<br />
operating system for internal calibrations and tests. Return zero instead<br />
of this rate in calls to <a href="Screen" class="uri">Screen</a>(‘Framerate’) or <a href="Screen" class="uri">Screen</a>(‘NominalFramerate’).<br />
This to work around broken or problematic video refresh reporting mechanisms.</p>
<p>2^23 == kPsychUseOldStyleAsyncFlips<br />
Do not use the enhanced <a href="Screen" class="uri">Screen</a>(‘AsyncFlipBegin’) implementation which<br />
allows for more parallelism between your code and pending async flips.<br />
There is no reason to use this flag except for benchmarking by PTB<br />
developers. Or, of course, if you should happen to have an operating<br />
system + graphics driver + GPU combo which performs much worse with the<br />
new method than with the old one.</p>
<p>2^24 == kPsychDontAutoEnableImagingPipeline<br />
Do not automatically enable support for fast offscreen windows on<br />
graphics cards (GPU’s) that support this. Do not automatically enable the<br />
full Psychtoolbox image processing pipeline on supported GPU’s for stereo<br />
display modes which would benefit from it.</p>
<p>On Psychtoolbox versions released before the year 2012, you needed to<br />
enable those two features manually. 2012+ PTB’s will auto-enable on<br />
suitable hardware if this promises improvements in performance,<br />
flexibility or robustness. In the unlikely case you should encounter<br />
problems with this behaviour due to graphics driver or operating system<br />
bugs, you can revert to the old opt-in behaviour: The <a href="PsychImaging" class="uri">PsychImaging</a>()<br />
command then allows you to enable those features manually and separately,<br />
just as on pre 2012 PTB’s.</p>
<p>2^25 == kPsychOldStyleOverrideRedirect<br />
Use the old-school method of setting the override_redirect property<br />
of X11 Windows on Linux, as it was done until end 2012. This just as<br />
a safe-guard in case somebody runs a very exotic or old Linux setup,<br />
where the new method doesn’t work.</p>
<p>2^26 == kPsychForceUseNativeBeamposQuery [Deprecated]<br />
Force use of the OSX builtin beamposition query mechanism, even if the<br />
<a href="PsychtoolboxKernelDriver" class="uri">PsychtoolboxKernelDriver</a> is installed and would provide better results.</p>
<p>As of Psychtoolbox 3.0.12, this does nothing anymore.</p>
<p>This was mostly for internal testing and benchmarking of Psychtoolbox. As<br />
of April 2013 and <a href="MacOSX" class="uri">MacOSX</a> 10.8 “Mountain Lion”, our own implementation was<br />
superior to Apple’s broken implementation, so we defaulted to use of our<br />
own implementation whenever possible. The OSX native implementation was<br />
only supported on <a href="NVidia" class="uri">NVidia</a> gpu’s anymore, scheduled for removal in a future<br />
OSX version (marked as deprecated in Apple developer documentation!),<br />
always slightly broken and more noisy, imprecise and higher overhead than<br />
our own implementation. At least on OSX 10.8 with <a href="GeForce" class="uri">GeForce</a>-600 gpu’s, the<br />
OSX implementation was completely broken for anything but analog VGA CRT<br />
displays, ie., it delivers bogus results for any kind of internal or<br />
external digital lcd flat panel! Since OSX 10.10, Apple removed their<br />
support completely, so current PTB can only use the <a href="PsychtoolboxKernelDriver" class="uri">PsychtoolboxKernelDriver</a><br />
method anyway.</p>
<p>2^27 == kPsychForceOpenMLTSWorkaround<br />
Force use of <a href="OpenML" class="uri">OpenML</a> swap completion timestamp workaround. This to<br />
workaround certain potential timestamping bugs in some graphics drivers.<br />
Currently no such bugs exist, so this option is just to future-proof<br />
your Psychtoolbox against potential bugs in future operating systems.<br />
Bugs were present in Linux versions 3.13 - 3.15 for a short period of<br />
time between April and July 2014 which made this workaround neccessary.<br />
However, the workaround is automatically enabled on such Linux versions<br />
without the need for this conservevram setting. The relevant Linux bugs<br />
have been fixed by mid-July 2014, ie., at the time of this writing, in all<br />
versions of the Linux kernel (Linux &gt;= 3.13.11.5+, 3.14.12+, 3.15.5+, 3.16+).<br />
Nonetheless we leave this manual way to enable the workaround, should the<br />
need ever arise again in the future.</p>
<p>2^28 == kPsychAssumeGfxCapVCGood<br />
Force the assumption that the graphics hardware is capable of processing<br />
<a href="OpenGL" class="uri">OpenGL</a> vertex colors at full 32 bpc floating point precision. This allows<br />
to avoid the use of special texture filter shaders when drawing bilinearly<br />
filtered floating point textures while color clamping is disabled on a<br />
floating point onscreen window or offscreen window. Instead the standard<br />
fixed function pipeline is used by default. By default Psychtoolbox assumes<br />
insufficient precision and uses such a shader, but some defective graphics<br />
drivers, e.g., for AMD graphics cards under Mac OSX 10.11 “El Capitan”, will<br />
perform bilinear texture sampling at insufficient precision, which can be a<br />
hazard for vision research which requires &gt; 8 bpc color/luminance/contrast<br />
precision. This flag allows to enforce fixed function as a potential plan B.<br />
The <a href="HighColorPrecisionDrawingTest" class="uri">HighColorPrecisionDrawingTest</a>() script will detect such defective graphics<br />
drivers and advice the user to use this flag in such situations.</p>
<p>–&gt; It’s always better to update your graphics drivers with fixed<br />
versions or buy proper hardware than using these workarounds. They are<br />
meant as a last ressort, e.g., if you need to get something going quickly<br />
or can’t get access to bug-fixed drivers.</p>
<div class="code_header" style="text-align:right;">
<p><span style="float:left;">Path  </span> <span class="counter">Retrieve <a href=
  "https://raw.github.com/Psychtoolbox-3/Psychtoolbox-3/beta/Psychtoolbox/PsychDocumentation/ConserveVRAMSettings.m">current version from GitHub</a> | View <a href=
  "https://github.com/Psychtoolbox-3/Psychtoolbox-3/commits/beta/Psychtoolbox/PsychDocumentation/ConserveVRAMSettings.m">changelog</a></span></p>
</div>
<div class="code">
<p><code>Psychtoolbox/PsychDocumentation/ConserveVRAMSettings.m</code></p>
</div>

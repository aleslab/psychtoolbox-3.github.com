<h2 id="psychtoolbox-psychglimageprocessing">[[Psychtoolbox]] › [[PsychGLImageProcessing]]</h2>
<p>Create a single-pass image processing shader for direct use with <a href="Screen" class="uri">Screen</a>(‘DrawTexture’)</p>
<h3 id="usage">Usage:</h3>
<p>[shader, varargout] = <a href="CreateSinglePassImageProcessingShader" class="uri">CreateSinglePassImageProcessingShader</a>(windowPtr, shaderType, varargin)</p>
<p>Creates a shader for window ‘windowPtr’ of type ‘shaderType’ with<br />
optional, type specific, parameters. Returns a handle ‘shader’ and<br />
optional other properties.</p>
<h3 id="the-following-types-are-currently-supported">The following types are currently supported:</h3>
<h1 id="backgroundmaskout">‘BackgroundMaskOut’</h1>
<p>shader = <a href="CreateSinglePassImageProcessingShader" class="uri">CreateSinglePassImageProcessingShader</a>(windowPtr, ‘BackgroundMaskOut’, backgroundColor [, tolerance]);<br />
- This shader draws a texture, but removes all “backgroundColor” pixels<br />
during drawing, effectively masking them out. ‘backgroundColor’ is a 3<br />
component [R, G, B] vector with the RGB color values of the color to be<br />
considered a background to remove. All color values around an euclidean<br />
distance of ‘tolerance’ in 3D color space around the backgroundColor are<br />
considered background color. The default tolerance is 0.001 units, which<br />
for 8 bit colors means a perfect match – zero tolerance.</p>
<h1 id="weightedcolorcomponentsum">‘WeightedColorComponentSum’</h1>
<p>shader = <a href="CreateSinglePassImageProcessingShader" class="uri">CreateSinglePassImageProcessingShader</a>(windowPtr, ‘WeightedColorComponentSum’);<br />
- This shader draws a texture by computing a weighted sum of the color values of all<br />
four color components (Red, Green, Blue, Alpha) for each input texel location (x,y),<br />
then outputs the resulting scalar value into all four components (Red, Green, Blue, Alpha)<br />
at location (x,y). The optional ‘modulateColor’ parameter of <a href="Screen" class="uri">Screen</a>(‘DrawTexture’, …);<br />
is used to define the weights used for the weighted sum:</p>
<p>For location (x,y) and color channels R,G,B,A, and Rin, Gin, Bin, Ain = input color values<br />
from texture, and Rout, Bout, Gout, Aout the drawn output colors:</p>
<p>sum = Rin(x,y) * modulateColor(1) + Gin(x,y) * modulateColor(2) + Bin(x,y) * modulateColor(3) + Ain(x,y) * modulateColor(4);<br />
Rout(x,y) = Gout(x,y) = Bout(x,y) = Aout(x,y) = sum;</p>
<p>One interesting application is computing linear combinations of up to four<br />
“grayscale” images or “alpha masks” by storing the four different grayscale<br />
or alpha images into the four color channels of a texture, then drawing that<br />
texture, using the four components of ‘modulateColor’ as linear combination<br />
weights to compute a “composite” output image which is mixed from the four<br />
input layers, according to their weights. The optional ‘colorMaskNew’ parameter<br />
of <a href="Screen" class="uri">Screen</a>(‘Blendfunction’) can be used to select which output color channels<br />
should then be actually written to by the result of this linear combination, e.g.,<br />
only RGB channels for a grayscale image, or only Alpha channel for a “morphed”<br />
alpha mask image.<br />
The <a href="moglmorpher" class="uri">moglmorpher</a>(‘morphTexture’) function allows more general image morphing with<br />
an arbitrary number of input image textures, but as long as no more than four<br />
“monochromatic” images are required, this shader is especially efficient for this task.</p>
<p>History:<br />
17.07.2011 mk Written.<br />
24.11.2014 mk Add ‘WeightedColorComponentSum’ shader support.</p>
<div class="code_header" style="text-align:right;">
<p><span style="float:left;">Path  </span> <span class="counter">Retrieve <a href=
  "https://raw.github.com/Psychtoolbox-3/Psychtoolbox-3/beta/Psychtoolbox/PsychGLImageProcessing/CreateSinglePassImageProcessingShader.m">current version from GitHub</a> | View <a href=
  "https://github.com/Psychtoolbox-3/Psychtoolbox-3/commits/beta/Psychtoolbox/PsychGLImageProcessing/CreateSinglePassImageProcessingShader.m">changelog</a></span></p>
</div>
<div class="code">
<p><code>Psychtoolbox/PsychGLImageProcessing/CreateSinglePassImageProcessingShader.m</code></p>
</div>

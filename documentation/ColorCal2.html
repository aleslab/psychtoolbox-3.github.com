<h2 id="psychtoolbox-psychhardware-colorcal2">[[Psychtoolbox]] › [[PsychHardware]] › [[ColorCal2]]</h2>
<p>varargout = <a href="ColorCal2" class="uri">ColorCal2</a>(command, [varargin])</p>
<p>Description:<br />
Interface function to communicate with the <a href="ColorCal2" class="uri">ColorCal2</a> USB device.</p>
<p>WINDOWS: On MS-Windows this driver needs to use a virtual COM port method<br />
to communicate, instead of the more feature-rich USB method on Linux or<br />
OSX. As a consequence, only a subset of functions is supported, as listed<br />
below, and device detection may be less reliable if you have other serial<br />
port devices or virtual COM port devices connected, unless you help the<br />
driver by telling it the right COM port: The device will show up as an<br />
additional serial port on the system. This driver will communicate with<br />
the device by establishing a serial port connection via that serial port.<br />
The driver will check for the existence of a configuration file named<br />
[<a href="PsychtoolboxConfigDir" class="uri">PsychtoolboxConfigDir</a> ‘ColorCal2Config.txt’]. If the file exists and is<br />
readable, then presence of a serial port name in the first line of that<br />
text configuration file will use the serial port with that name for<br />
communication, otherwise the driver will try to auto-detect the proper<br />
serial port for communication. E.g., if the file would contain one line<br />
with the text COM3 then virtual COM port 3 would be used for serial port<br />
communication.</p>
<p>OSX: OSX 10.12 or later is required for this function to work. For older<br />
OSX versions, look for instructions on the CRS Ltd. website.</p>
<p>LINUX: If you want to use this function without the need to run Matlab or<br />
Octave as root user (i.e., without need for root login or the sudo<br />
command), please run <a href="PsychLinuxConfiguration" class="uri">PsychLinuxConfiguration</a> once (this will happen<br />
automatically if you install, update or setup Psychtoolbox via<br />
<a href="DownloadPsychtoolbox" class="uri">DownloadPsychtoolbox</a>, <a href="UpdatePsychtoolbox" class="uri">UpdatePsychtoolbox</a> or <a href="SetupPsychtoolbox">SetupPsychtoolbox)</a>), or<br />
alternatively copy the file<br />
Psychtoolbox/<a href="PsychHardware" class="uri">PsychHardware</a>/<a href="ColorCal2" class="uri">ColorCal2</a>/60-cambridgeresearch-permissions.rules<br />
into the folder /etc/udev/rules.d/ on your system. This one-time copy<br />
will require administrator privileges, but after that, any user should be<br />
able to use the <a href="ColorCal" class="uri">ColorCal</a> devices or other CRS Ltd. devices without<br />
special permissions.</p>
<p>Required Input:<br />
command (string) - Command to send to the <a href="ColorCal2" class="uri">ColorCal2</a> device. Commands are<br />
case insensitive.</p>
<p>Optional Input:<br />
varargin - Argument(s) required for a subset of the <a href="ColorCal2" class="uri">ColorCal2</a><br />
commands. Varies depending on the command.</p>
<p>Optional Output:<br />
varargout - Value(s) returned for a subset of the <a href="ColorCal2" class="uri">ColorCal2</a> commands.</p>
<h3 id="command-list-for-all-operating-systems">Command List for all operating systems:</h3>
<p>‘DeviceInfo’ - Retrieves the following device information in a struct:<br />
firmware version number, 8 digit serial number, and firmware build<br />
number. The struct’s fields are romVersion, serialNumber,<br />
buildNumber.</p>
<pre><code> Example:  
 devInfo = [ColorCal2](ColorCal2)(&#39;DeviceInfo&#39;);  </code></pre>
<p>‘MeasureXYZ’ - Measures the tri-stimulus value of the current light.<br />
Returns a struct with x, y, and z in floating point format. These<br />
values should be corrected by multiplying them against the calibration<br />
matrix typically stored in the 1st calibration matrix in the device.</p>
<pre><code> Example: Retrieve the xyz values and correct them with the 1st  
          calibration matrix.  
 cMatrix = [ColorCal2](ColorCal2)(&#39;ReadColorMatrix&#39;);  
 s = [ColorCal2](ColorCal2)(&#39;MeasureXYZ&#39;);  
 correctedValues = cMatrix(1:3,:) \* [s.x s.y s.z]&#39;;  </code></pre>
<p>‘ReadColorMatrix’ or ‘ReadColourMatrix’ - Retrieves all 3 color<br />
calibration matrices from the device and returns them as a 9x3 matrix.<br />
Each set of 3 rows represents a single calibration matrix. All<br />
values will be in floating point format.</p>
<p>‘ZeroCalibration’ - Removes small zero errors in the electronic system of<br />
the <a href="ColorCal2" class="uri">ColorCal2</a> device. It reads the current light level and stores<br />
the readings in a zero correction array. All subsequent light<br />
readings have this value subtracted from them before being returned.<br />
This command is intended to be issued when the <a href="ColorCal2" class="uri">ColorCal2</a> is in the<br />
dark. Returns 1 if the command succeeds, 0 if it fails. This<br />
command must be run after every power cycle of the device.</p>
<p>‘<a href="Close" class="uri">Close</a>’ - <a href="Close" class="uri">Close</a> connection to device. A ‘clear all’ or ‘clear ColorCal2’ or<br />
quitting Octave or Matlab will also close the connection, so this is<br />
not strictly needed.</p>
<h3 id="all-the-following-commands-are-not-supported-on-ms-windows-only-on-linux-and-osx">All the following commands are not supported on MS-Windows, only on Linux and OSX:</h3>
<p>‘GetRawData’ - Returns the raw data for all three light channels, the<br />
contents of the zero correction array for all three channels, and<br />
the current reading of the trigger ADC. Returns a single struct<br />
containing the following fields: Xdata, Xzero, Ydata, Yzero, Zdata,<br />
Zzero, Trigger. All values are unformatted.</p>
<p>‘LEDOn’ - Turns the LED on.</p>
<p>‘LEDOff’ - Turns the LED off.</p>
<p>‘SetLEDFunction’ - Controls whether the LED is illuminated when the<br />
trigger signal is generated. This state is stored in non-volatile<br />
memory and will survive a power cycle. Takes 1 additional argument:<br />
0 or 1. 0 = LED not active when triggered, 1 = LED active when<br />
triggered.</p>
<p>‘SetTriggerThreshold’ - Sets the threshold which must be exceeded by the<br />
first derivative of the trigger ADC before a trigger pulse is<br />
generated. It is stored in non-volatile memory and will survive a<br />
power cycle. Takes 1 additional argument which is the trigger<br />
threshold value.</p>
<p>‘StartBootloader’ - Causes the <a href="ColorCal2" class="uri">ColorCal2</a> to start its internal bootloader<br />
in preparation for a firmware upgrade.</p>
<div class="code_header" style="text-align:right;">
<p><span style="float:left;">Path  </span> <span class="counter">Retrieve <a href=
  "https://raw.github.com/Psychtoolbox-3/Psychtoolbox-3/beta/Psychtoolbox/PsychHardware/ColorCal2/ColorCal2.m">current version from GitHub</a> | View <a href=
  "https://github.com/Psychtoolbox-3/Psychtoolbox-3/commits/beta/Psychtoolbox/PsychHardware/ColorCal2/ColorCal2.m">changelog</a></span></p>
</div>
<div class="code">
<p><code>Psychtoolbox/PsychHardware/ColorCal2/ColorCal2.m</code></p>
</div>

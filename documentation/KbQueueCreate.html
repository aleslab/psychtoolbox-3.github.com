<h2 id="psychtoolbox-psychbasic">[[Psychtoolbox]] › [[PsychBasic]]</h2>
<p><a href="KbQueueCreate" class="uri">KbQueueCreate</a>([deviceNumber][, keyList][, numValuators=0][, numSlots=10000][, flags=0])</p>
<p>The routines <a href="KbQueueCreate" class="uri">KbQueueCreate</a>, <a href="KbQueueStart" class="uri">KbQueueStart</a>, <a href="KbQueueStop" class="uri">KbQueueStop</a>, <a href="KbQueueCheck" class="uri">KbQueueCheck</a><br />
<a href="KbQueueWait" class="uri">KbQueueWait</a>, <a href="KbQueueFlush" class="uri">KbQueueFlush</a> and <a href="KbQueueRelease" class="uri">KbQueueRelease</a> provide replacements for<br />
<a href="KbCheck" class="uri">KbCheck</a> and <a href="KbWait" class="uri">KbWait</a>, providing the following advantages:</p>
<pre><code>1) Brief key presses that would be missed by [KbCheck](KbCheck) or [KbWait](KbWait)  
   are reliably detected  
2) The times of key presses are recorded more accurately  
3) The times of key releases are also recorded  </code></pre>
<h3 id="limitations">Limitations:</h3>
<pre><code>1) If a key is pressed multiple times before [KbQueueCheck](KbQueueCheck) is called,  
   only the times of the first and last presses and releases of that  
   key can be recovered (this has no effect on other keys)  
2) If many keys are pressed very quickly in succession on OSX, it is  
   at least theoretically possible for the queue to fill more quickly  
   than it can be emptied, losing key events temporarily while filled  
   to capacity. The queue holds up to thirty events, and events are  
   constantly being removed from the queue and processed, so this is  
   unlikely to be a problem in actual use.  </code></pre>
<p>The deviceNumber of a HID input device can be specified as ‘deviceNumber’.<br />
Allowable devices are “keyboard like” devices, e.g., Keyboards, Keypads,<br />
Mouse, Joystick, Gamepad, Touchpad, etc. - Stuff that has buttons or keys<br />
to press. This way a mouse or joysticks buttons can be used as response<br />
devices, ignoring mouse movements etc. If deviceNumber is not specified, the first<br />
device is the default (like <a href="KbCheck">KbCheck)</a>). If <a href="KbQueueCreate" class="uri">KbQueueCreate</a> has not been called<br />
first, the other routines will generate an error message. Likewise, if<br />
<a href="KbQueueRelease" class="uri">KbQueueRelease</a> has been called more recently than <a href="KbQueueCreate" class="uri">KbQueueCreate</a>, the other<br />
routines will generate error messages.</p>
<p>It is acceptable to call <a href="KbQueueCreate" class="uri">KbQueueCreate</a> at any time (e.g., to switch to a new<br />
device or to change the list of queued keys) without calling <a href="KbQueueRelease" class="uri">KbQueueRelease</a>.</p>
<p><a href="KbQueueCreate" class="uri">KbQueueCreate</a>([deviceNumber][, keyList][, numValuators=0][, numSlots=10000][, flags=0])<br />
Creates the queue for the specified (or default) device number<br />
If the device number is less than zero, the default device is used.</p>
<pre><code> &#39;keyList&#39; is an optional 256-length vector of doubles (not logicals)  
 with each element corresponding to a particular key (use [KbName](KbName)  
 to map between keys and their positions). If the double value  
 corresponding to a particular key is zero, events for that key  
 are not added to the queue and will not be reported.  

 &#39;numValuators&#39; is an optional maximum number of additional values to report.  
 It defaults to zero. For values greater than zero, if the selected type  
 of input device supports this, and if the operating system supports this,  
 additional info will be recorded. For pointing devices like mice, the mouse  
 position may be reported, for joysticks the state of their various axis, etc.  
 For mouse/joystick/pointing device position reporting numValuators must be  
 at least 2. On touch devices, a value of 2 treats them like a mouse, a value  
 \&gt;= 4 treats them as touchscreen. However, for touch devices there are separate  
 functions like [TouchQueueCreate](TouchQueueCreate), [TouchEventGet](TouchEventGet) etc. for convenient handling.  
 See &quot;help [KbEventGet](KbEventGet)&quot; for how to retrieve potential additionally recorded  
 information.  

 &#39;numSlots&#39; defines how many events the event buffer can store. If a script  
 does not periodically remove events via [KbEventGet](KbEventGet)() or [KbEventFlush](KbEventFlush)(), the  
 buffer will fill up, and once &#39;numSlots&#39; elements are stored, it will stop  
 recording new events. 10000 elements capacity is the default, which may be  
 too little if you use &#39;numValuators&#39; \&gt; 0 to store dynamic (motion) data like  
 mouse movements or touchscreen input, which can be generated at rates of  
 multiple hundred events per second of data collection.  

 &#39;flags&#39; defines special modes of operation for the queue. These are OS  
 specific, see &quot;[PsychHID](PsychHID) [KbQueueCreate](KbQueueCreate)?&quot; for an up to date list of supported  
 flags. In general, you don&#39;t need these.  

 No events are delivered to the queue until [KbQueueStart](KbQueueStart) or   
 [KbQueueWait](KbQueueWait) is called.  
 [KbQueueCreate](KbQueueCreate) can be called again at any time. The function can also  
 treat other HID devices with buttons or keys as if they are  
 keyboards. E.g., it can also record button state of a mouse, a  
 joystick or a gamepad.  </code></pre>
<p><a href="KbQueueStart" class="uri">KbQueueStart</a>([deviceNumber])<br />
Starts delivering keyboard events from the specified device to the<br />
queue.</p>
<p><a href="KbQueueStop" class="uri">KbQueueStop</a>([deviceNumber])<br />
Stops delivery of new keyboard events from the specified device to<br />
the queue.<br />
Data regarding events already queued is not cleared and can be<br />
recovered by <a href="KbQueueCheck" class="uri">KbQueueCheck</a></p>
<p>[pressed, firstPress, firstRelease, lastPress, lastRelease]=<br />
<a href="KbQueueCheck" class="uri">KbQueueCheck</a>([deviceNumber])<br />
Obtains data about keypresses on the specified device since the<br />
most recent call to this routine, <a href="KbQueueStart" class="uri">KbQueueStart</a>, <a href="KbQueueWait" class="uri">KbQueueWait</a><br />
Clears all scored events, but unscored events that are still being<br />
processsed may remain in the queue</p>
<pre><code> pressed: a boolean indicating whether a key has been pressed  

 firstPress: an array indicating the time that each key was first  
   pressed since the most recent call to [KbQueueCheck](KbQueueCheck) or [KbQueueStart](KbQueueStart)  

 firstRelease: an array indicating the time that each key was first  
   released since the most recent call to [KbQueueCheck](KbQueueCheck) or [KbQueueStart](KbQueueStart)  

 lastPress: an array indicating the most recent time that each key was  
   pressed since the most recent call to [KbQueueCheck](KbQueueCheck) or [KbQueueStart](KbQueueStart)  

 lastRelease: an array indicating the most recent time that each key  
    was released since the most recent call to [KbQueueCheck](KbQueueCheck) or   
    [KbQueueStart](KbQueueStart)  

For firstPress, firstRelease, lastPress and lastRelease, a time value  
  of zero indicates that no event for the corresponding key was  
  detected since the most recent call to [KbQueueCheck](KbQueueCheck) or [KbQueueStart](KbQueueStart)  

To identify specific keys, use [KbName](KbName) (e.g., [KbName](KbName)(firstPress)) to  
  generate a list of the keys for which the events occurred  

For compatibility with [KbCheck](KbCheck), any key codes stored in  
ptb\_kbcheck\_disabledKeys (see &quot;help [DisableKeysForKbCheck](DisableKeysForKbCheck)&quot;), will  
not cause pressed to return as true and will be zeroed out in the  
returned arrays. However, a better alternative is to specify a  
keyList arguement to [KbQueueCreate](KbQueueCreate).   </code></pre>
<p>secs=<a href="KbQueueWait" class="uri">KbQueueWait</a>([deviceNumber])<br />
Waits for any key to be pressed and returns the time of the press.</p>
<pre><code> [KbQueueFlush](KbQueueFlush) should be called immediately prior to this function  
 (unless the queue has just been created and started) to clear any   
 prior events.  

 Note that this command will not respond to any keys that were   
 inactivated by using the keyList argument to [KbQueueCreate](KbQueueCreate).  

 Since [KbQueueWait](KbQueueWait) is implemented as a looping call to  
 [KbQueueCheck](KbQueueCheck), it will not respond to any key codes stored in  
 the global variable ptb\_kbcheck\_disabledKeys  
 (see &quot;help [DisableKeysForKbCheck](DisableKeysForKbCheck)&quot;)  </code></pre>
<p><a href="KbQueueFlush" class="uri">KbQueueFlush</a>([deviceNumber])<br />
Removes all unprocessed events from the queue and zeros out any<br />
already scored events.</p>
<p><a href="KbQueueRelease" class="uri">KbQueueRelease</a>([deviceNumber])<br />
Releases queue-associated resources; once called, <a href="KbQueueCreate" class="uri">KbQueueCreate</a><br />
must be invoked before using any of the other routines</p>
<pre><code> This routine is called automatically at clean-up (e.g., when   
 &#39;clear mex&#39; is invoked and can be omitted expense of keeping   
 memory allocated and an additional thread running unnecesarily  </code></pre>
<p>Note that any keyboard typing used to invoke <a href="KbQueue" class="uri">KbQueue</a> commands will be<br />
recorded. This would include the release of the carriage return used<br />
to execute <a href="KbQueueStart" class="uri">KbQueueStart</a> and the keys pressed and released to invoke<br />
<a href="KbQueueCheck" class="uri">KbQueueCheck</a><br />
_________________________________________________________________________</p>
<p>See also: <a href="KbQueueCreate" class="uri">KbQueueCreate</a>, <a href="KbQueueStart" class="uri">KbQueueStart</a>, <a href="KbQueueStop" class="uri">KbQueueStop</a>, <a href="KbQueueCheck" class="uri">KbQueueCheck</a>,<br />
<a href="KbQueueWait" class="uri">KbQueueWait</a>, <a href="KbQueueFlush" class="uri">KbQueueFlush</a>, <a href="KbQueueRelease" class="uri">KbQueueRelease</a></p>
<div class="code_header" style="text-align:right;">
<p><span style="float:left;">Path  </span> <span class="counter">Retrieve <a href=
  "https://raw.github.com/Psychtoolbox-3/Psychtoolbox-3/beta/Psychtoolbox/PsychBasic/KbQueueCreate.m">current version from GitHub</a> | View <a href=
  "https://github.com/Psychtoolbox-3/Psychtoolbox-3/commits/beta/Psychtoolbox/PsychBasic/KbQueueCreate.m">changelog</a></span></p>
</div>
<div class="code">
<p><code>Psychtoolbox/PsychBasic/KbQueueCreate.m</code></p>
</div>

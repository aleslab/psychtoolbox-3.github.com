<h2 id="psychtoolbox-psychpriority">[[Psychtoolbox]] › [[PsychPriority]]</h2>
<p>oldPriority=<a href="Priority" class="uri">Priority</a>([newPriority])</p>
<p>Query and optionally set the execution priority of your script to<br />
‘newPriority’ and switch from non-realtime to realtime scheduling (for<br />
‘newPriority’ values greater than zero).</p>
<p>Higher priority levels will reduce the chance of other running<br />
applications and system processes interfering with the execution timing<br />
of your script, or reduce the severity of interference. However, various<br />
factors influence the timing behaviour of your computer and its hardware,<br />
so while use of <a href="Priority" class="uri">Priority</a>() is one step to ensure good timing, it is not<br />
the only required step. The <a href="PsychDocumentation" class="uri">PsychDocumentation</a> subfolder of your<br />
distribution as well as the Psychtoolbox Wiki contain various documents<br />
with tips on how to improve system timing behaviour. All else being<br />
equal, the Linux operating system should provide best possible timing<br />
behaviour out of the box, with various possibilities to tweak and tune the<br />
system for even better timing behaviour. Mac OSX is the second best<br />
choice for precise timing.</p>
<p>OS X: ___________________________________________________________________</p>
<p>Unlike on OS 9 and Windows, On OS X setting a high priority will not<br />
disable important parts of your computer such as the keybaord and hard<br />
drive. <a href="Priority" class="uri">Priority</a> calls the Psychtoolbox mex function <a href="MachSetPriority" class="uri">MachSetPriority</a>. For<br />
simple, OS-neutral control of process priority on OS X use <a href="Priority" class="uri">Priority</a>. For<br />
complicated, fine-grained, OS-specific control of process priority use<br />
<a href="MachSetPriority" class="uri">MachSetPriority</a>.</p>
<p>At priority settings greater than 0, your script must limit MATLAB’s use<br />
of CPU time to stay within the limits specified by the priority value.<br />
The consequence of failing to restrict the CPU time to the limits<br />
specified by the priority values is that OS X will demote MATLAB back to<br />
priority 0. You can check to see if this has happened by calling<br />
<a href="Priority" class="uri">Priority</a> with no arguments.</p>
<h3 id="within-a-script-there-are-two-ways-to-limit-matlabs-use-of-cpu-time">Within a script there are two ways to limit MATLAB’s use of CPU time:</h3>
<ol type="1">
<li>Call “<a href="WaitSecs" class="uri">WaitSecs</a>”<br />
</li>
<li>Call <a href="Screen" class="uri">Screen</a>(‘<a href="Flip" class="uri">Flip</a>’,…)</li>
</ol>
<p>Both calls will sleep the main MATLAB thread, surrendering CPU time to<br />
other threads on the system until the MATLAB thread is awakened.<br />
<a href="WaitSecs" class="uri">WaitSecs</a> sleeps the MATLAB thread for a specified period.<br />
<a href="Screen" class="uri">Screen</a>(‘<a href="Flip" class="uri">Flip</a>’,…) sleeps the MATLAB thread until the next video blanking<br />
interval.</p>
<p>The priority value corresponds to the proportion of the video frame<br />
period during which MATLAB is guranteed 100 percent of CPU time:</p>
<p><a href="GuaranteedCPUtimePerFramePeriod" class="uri">GuaranteedCPUtimePerFramePeriod</a> = priority/10 * framePeriod</p>
<p>If your computer has multiple video displays running at different frame<br />
rates then <a href="Priority" class="uri">Priority</a> will choose the shortest frame period.</p>
<p>The consequence of a thread exceeding the specified limits on CPU usage<br />
are that the MACH kernel will revoke its real-time priority status.<br />
However, the threshold at which the MACH kernel decices to revoke<br />
priority is not known. We have observed that at 100% CPU usage the<br />
Jaguar Mach kernel will revoke priority after 2.5 seconds, indepent of<br />
the CPU time requested when setting priority.</p>
<p>Note that if you change the video frame rate after setting priority then<br />
the framePeriod which <a href="Priority" class="uri">Priority</a> used when setting the priority level will<br />
no longer match the true frame period. Therefore you should change the<br />
priority level after changing the video mode and not before.</p>
<p>WINDOWS: ________________________________________________________________</p>
<p>For the Windows version of <a href="Priority" class="uri">Priority</a> (and <a href="Rush" class="uri">Rush</a>), the priority levels set<br />
are “process priority levels”. There are 3 priority levels available,<br />
levels 0, 1, and 2. Level 0 is “normal priority level”, level 1 is “high<br />
priority level”, and level 2 is “real time priority level”. Combined with<br />
thread priority levels, they determine the absolute priority level of the<br />
Psychtoolbox threads. Threads are executed in a “round robin” fashion on<br />
Windows, with the lower priority threads getting cpu time slice only<br />
when no higher priority thread is ready to execute. Currently, no tests<br />
have been done to see what tasks are pre-empted by setting the Matlab<br />
process to real-time priority. It does seem to block keyboard input,<br />
though, so for example if you have a clut animation going on at priority<br />
level 2, then the force-quit key combo (Ctrl-Alt-Delete) does not work.<br />
However, the keyboard inputs are still sent to the message queue, so<br />
<a href="GetChar" class="uri">GetChar</a> or <a href="GetClicks" class="uri">GetClicks</a> still work if they are also called at priority level<br />
2.</p>
<p>Typically you will not want to choose a higher priority than 1 unless you<br />
know exactly what you’re doing.</p>
<p>LINUX: __________________________________________________________________</p>
<p>To enable use of <a href="Priority" class="uri">Priority</a>(), you must run the script<br />
<a href="PsychLinuxConfiguration" class="uri">PsychLinuxConfiguration</a> at least once and follow its instructions.<br />
Normally the script will get executed automatically by our installer if<br />
you got Psychtoolbox via <a href="DownloadPsychtoolbox" class="uri">DownloadPsychtoolbox</a> or <a href="UpdatePsychtoolbox" class="uri">UpdatePsychtoolbox</a>.<br />
However, if you got Psychtoolbox directly from the package manager of<br />
your Linux distribution or from the <a href="NeuroDebian" class="uri">NeuroDebian</a> repositories, it may be<br />
neccessary to execute the <a href="PsychLinuxConfiguration" class="uri">PsychLinuxConfiguration</a> function manually.</p>
<p>GNU/Linux supports priority levels between 0 and 99. Zero means standard<br />
non-realtime timesharing operation – Play fair with all other<br />
applications. Increasing values greater than zero mean realtime mode: The<br />
Matlab/Octave process is scheduled in realtime mode with a priority<br />
corresponding to the given number - higher means better, but also more<br />
likelihood of interfering with system processes. Try to stick to a level<br />
of 1 unless you have reason to go higher. Level one is usually<br />
sufficient, unless you run other realtime applications on the same<br />
machine in parallel and want to prioritize Psychtoolbox relative to those<br />
applications.</p>
<p>In realtime mode, PTB will also try to lock down all of Matlab/Octaves<br />
memory into physical RAM, preventing it from being paged out to disk by<br />
the virtual memory manager. If it works, it’s great! However, the amount<br />
of lockable memory is restricted to max. 50% of installed RAM memory on<br />
some older Linux setups, so if Matlab/Octave/your experiment would need<br />
more than 50% of available system memory, this will fail. PTB will output<br />
an informative warning in this case, but continue otherwise unaffected.<br />
Realtime scheduling will be still effective, you’ll just lose the bonus<br />
of memory locking.</p>
<p>On old single processor computers, be careful not to create any<br />
uninterruptible infinite loops in your code when running realtime,<br />
otherwise your system may lock up, requiring a hard reboot!<br />
_________________________________________________________________________</p>
<p>see also OS X: <a href="Rush" class="uri">Rush</a><br />
see also Windows: <a href="Rush" class="uri">Rush</a><br />
see also OS 9: <a href="Rush" class="uri">Rush</a>, <a href="ScreenTest" class="uri">ScreenTest</a>, <a href="RushTest" class="uri">RushTest</a>, <a href="LoopTest" class="uri">LoopTest</a></p>
<div class="code_header" style="text-align:right;">
<p><span style="float:left;">Path  </span> <span class="counter">Retrieve <a href=
  "https://raw.github.com/Psychtoolbox-3/Psychtoolbox-3/beta/Psychtoolbox/PsychPriority/Priority.m">current version from GitHub</a> | View <a href=
  "https://github.com/Psychtoolbox-3/Psychtoolbox-3/commits/beta/Psychtoolbox/PsychPriority/Priority.m">changelog</a></span></p>
</div>
<div class="code">
<p><code>Psychtoolbox/PsychPriority/Priority.m</code></p>
</div>

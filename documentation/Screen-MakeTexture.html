<h1 id="screenmaketexture"><a href="Screen-MakeTexture">Screen(‘MakeTexture’)</a></h1>
<h2 id="psychtoolbox-screen.mexdll-subfunction">[[Psychtoolbox]] › [[Screen]].{mex*,dll} subfunction</h2>
<p>Convert the 2D or 3D matrix ‘imageMatrix’ into an <a href="OpenGL" class="uri">OpenGL</a> texture and return an<br />
index which may be passed to ‘DrawTexture’ to specify the texture.<br />
In the <a href="OpenGL" class="uri">OpenGL</a> Psychtoolbox textures replace offscreen windows for fast drawing<br />
of images during animation.<br />
The imageMatrix argument may consist of one monochrome plane (Luminance), LA<br />
planes, RGB planes, or RGBA planes where A is alpha, the transparency of a<br />
pixel. Alpha values typically range between zero (=fully transparent) and 255<br />
(=fully opaque).<br />
The <a href="Screen" class="uri">Screen</a>(‘ColorRange’) command affects the range of expected input values in<br />
‘imageMatrix’ matrices of double precision type, as does the optional<br />
‘floatprecision’ flag discussed below.<br />
You need to enable Alpha-Blending via <a href="Screen" class="uri">Screen</a>(‘BlendFunction’,…) for the<br />
transparency values to have an effect.<br />
The argument ‘optimizeForDrawAngle’ if provided, asks Psychtoolbox to optimize<br />
the texture for especially fast drawing at the specified rotation angle. The<br />
default is 0 == Optimize for upright drawing. If ‘specialFlags’ is set to 1 and<br />
the width and height of the imageMatrix are powers of two (e.g., 64 x 64, 256 x<br />
256, 512 x 512, …), or your graphics card supports so called non-power-of-two<br />
textures, then the texture is created as an <a href="OpenGL" class="uri">OpenGL</a> texture of type<br />
GL_TEXTURE_2D. Otherwise Psychtoolbox will try to pick the most optimal format<br />
for fast drawing and low memory consumption. GL_TEXTURE_2D textures are<br />
especially useful for animation of drifting gratings, for simple use with the<br />
<a href="OpenGL" class="uri">OpenGL</a> 3D graphics functions and for blurring. Use of GL_TEXTURE_2D textures is<br />
currently not automatically compatible with use of specialFlags settings 2 or 4.<br />
If ‘specialFlags’ is set to 2 then PTB will try to use its own high quality<br />
texture filtering algorithm for drawing of bilinearly filtered textures instead<br />
of the hardwares built-in method. This only works on modern hardware with<br />
fragment shader support and is slower than using the hardwares built in<br />
filtering, but it may provide higher precision on some hardware. PTB<br />
automatically enables its own filter algorithm when used with floating point<br />
textures or when <a href="Screen" class="uri">Screen</a>(‘ColorRange’) is used to enable unclamped color<br />
processing: PTB will check if your hardware is capable of unrestricted high<br />
precision color processing in that case. If your hardware can’t guarantee high<br />
precision, PTB will enable its own shader-based workarounds to provide higher<br />
precision at the cost of lower speed.<br />
If ‘specialFlags’ is set to 4 then PTB tries to use an especially fast method of<br />
texture creation. This method can be at least an order of magnitude faster on<br />
some systems. However, it only works on modern <a href="GPUs" class="uri">GPUs</a>, only for certain maximum<br />
image sizes, and with some restrictions, e.g., scrolling of textures or<br />
high-precision filtering may not work at all or as well. Your mileage may vary,<br />
so only use this flag if you need extra speed and after verifying your stimuli<br />
still look correct. The biggest speedup is expected for creation of standard 8<br />
bit integer textures from uint8 input matrices, e.g., images from imread(), but<br />
also for 8 bit integer Luminance+Alpha and RGB textures from double format input<br />
matrices.<br />
A ‘specialFlags’ == 8 will prevent automatic mipmap-generation for GL_TEXTURE_2D<br />
textures.<br />
A ‘specialFlags’ == 32 setting will prevent automatic closing of the texture if<br />
<a href="Screen" class="uri">Screen</a>(‘<a href="Close" class="uri">Close</a>’); is called. Only <a href="Screen" class="uri">Screen</a>(‘<a href="Close" class="uri">Close</a>’, textureIndex); would close the<br />
texture.<br />
‘floatprecision’ defines the precision with which the texture should be stored<br />
and processed. Default value is zero, which asks to store textures with 8 bit<br />
per color component precision, a suitable format for standard images read via<br />
imread(). A non-zero value will store the textures color component values as<br />
floating point precision numbers, useful for complex blending operations and<br />
calculations on the textures and for processing and display of high dynamic<br />
range image textures, either on a LDR display via tone-mapping, or on a HDR<br />
display. If floatprecision is set to 1, the texture gets stored in half_float<br />
format, i.e. 16 bit per color component - Suitable for most display purposes and<br />
fast on recent gfx-hardware. A value of 2 asks for full 32 bit single precision<br />
float per color component. Useful for complex computations and image processing,<br />
but can be extremely slow when texture filtering is used on any piece of<br />
graphics hardware manufactured before the year 2007. If a value of 1 is<br />
provided, asking for 16 bit floating point textures, but the graphics hardware<br />
does not support this, then PTB tries to allocate a 15 bit precision signed<br />
integer texture instead, assuming the graphics hardware supports that. Such a<br />
texture is more precise than the 16 bit floating point texture it replaces, but<br />
can not store values outside the range [-1.0; 1.0]. On <a href="OpenGL" class="uri">OpenGL</a>-ES hardware, a 32<br />
bit floating point texture is selected instead.<br />
‘textureOrientation’ This optional argument labels textures with a special<br />
orientation. Normally (value 0) a Matlab matrix is passed in standard Matlab<br />
column-major dataformat. This is efficient for drawing of textures but not for<br />
processing them via <a href="Screen" class="uri">Screen</a>(‘TransformTexture’). Therefore textures need to be<br />
transformed on demand if used that way. This flag allows to short-cut the<br />
process: A setting of 1 will ask for immediate conversion into the optimized<br />
format. A setting of 2 will tell PTB that the Matlab matrix has been already<br />
converted into optimal format, so no further processing is needed. A value of 3<br />
tells PTB that the texture is completely isotropic, with no real orientation,<br />
therefore no conversion is required. This latter setting only makes sense for<br />
random noise textures or other textures generated from a distribution with<br />
uncorrelated noise-like pixels, e.g., some power spectrum distribution.<br />
‘textureShader’ - optional: If you provide the handle of an <a href="OpenGL" class="uri">OpenGL</a> GLSL shader<br />
program, then this shader program will be executed (bound) during drawing of<br />
this texture via the <a href="Screen" class="uri">Screen</a>(‘DrawTexture’,…); command – The normal texture<br />
drawing operation is replaced by your customized algorithm. This is useful for<br />
two purposes: a) Very basic on-the-fly image processing on the texture. b)<br />
Procedural shading: Your texture matrix doesn’t encode an image, but only<br />
per-pixel parameters as input for some formula to compute the real image during<br />
drawing. E.g., instead of defining a gabor patch as image or other standard<br />
stimulus, one could define it as a mathematical formula to be evaluated at<br />
draw-time. The <a href="Screen" class="uri">Screen</a>(‘SetOpenGLTexture’) command allows you to create purely<br />
virtual textures which only consist of such a shader and some virtual size, but<br />
don’t have any real data matrix associated with it – all content is generated<br />
on the fly.</p>
<p>&lt;&lt;=====See also:===== DrawTexture TransformTexture BlendFunction &lt;&lt;</p>

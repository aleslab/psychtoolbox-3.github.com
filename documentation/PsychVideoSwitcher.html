<h2 id="psychtoolbox-psychglimageprocessing">[[Psychtoolbox]] › [[PsychGLImageProcessing]]</h2>
<p><a href="PsychVideoSwitcher" class="uri">PsychVideoSwitcher</a>(command [,arg1, arg2, …..]);</p>
<p>Psychtoolbox support for the Xiangrui Li et al. “<a href="VideoSwitcher" class="uri">VideoSwitcher</a>” video<br />
attenuator device for high precision luminance output with up to 16 bits<br />
luminance resolution.</p>
<p>This routine incorporates code contributed by Xiangru Li for switching<br />
between monochrome and color display mode and for performing the<br />
reference Matlab routines for image formatting.</p>
<p>Options: ‘command’ is a command string, specifying a subcommand. The<br />
following subcommands are supported with the following options:</p>
<h3 id="public-functions">Public functions:</h3>
<p><a href="PsychVideoSwitcher" class="uri">PsychVideoSwitcher</a>(‘SwitchMode’, screenIdx, enableLuminanceMode [, <a href="VideoSwitcherIsABox" class="uri">VideoSwitcherIsABox</a>])<br />
- Switch programmatically between high precision luminance mode and<br />
standard RGB true color display mode. ‘screenIdx’ is the screen index of the<br />
for the display screen to switch.</p>
<p>‘enableLuminanceMode’ is meaningful only for card <a href="VideoSwitcher" class="uri">VideoSwitcher</a>, which<br />
must be set to 0 to switch to RGB mode, and to 1 to switch to high<br />
precision luminance mode. For box version, the <a href="SwitchMode" class="uri">SwitchMode</a> subfunction<br />
ignores the third input, and only toggles between two display modes,<br />
equivalent to pushing the switch button on the box.</p>
<p>‘VideoSwitcherIsABox’ is an optional argument: If set to 1, then perform<br />
switching procedure for an external (box) device. If set to zero, then<br />
perform procedure for an internal (PCI card) device. If argument is<br />
omitted, the proper default type is read from a configuration file stored<br />
in the path mypath = <a href="PsychtoolboxConfigDir" class="uri">PsychtoolboxConfigDir</a>(‘VideoSwitcher’);</p>
<p>If you create a file named ‘VideoSwitcherIsABox’ in that directory<br />
mypath, the switcher is assumed to be an external box. If you create a<br />
file named ‘VideoSwitcherIsACard’, the code assumes a PCI card based<br />
device. If no such files exist, the switcher is assumed to be a box.</p>
<p>It is important for the code to know if the switcher is a box or a card,<br />
as the switching strategy is different.</p>
<p><a href="PsychVideoSwitcher" class="uri">PsychVideoSwitcher</a>(‘SetTrigger’, win, triggerLine [, count=infinite]);<br />
- Set trigger line and options for <a href="VideoSwitcher" class="uri">VideoSwitcher</a> connected to the display<br />
of onscreen window ‘win’.</p>
<p>‘triggerLine’ defines the vertical (y) position of a trigger line to be<br />
drawn to the green channel of the final image, in order to trigger the<br />
trigger-circuit of the <a href="VideoSwitcher" class="uri">VideoSwitcher</a>. If you set it to a negative value<br />
or to empty [], triggering will be disabled (This is the default).</p>
<p>‘count’ Optional: Number of redraw cycles (invocations of<br />
<a href="Screen" class="uri">Screen</a>(‘<a href="Flip" class="uri">Flip</a>’)), that the triggerline should be drawn. If left out, the<br />
line will be drawn on each redraw until disabled. If set to some value,<br />
it will be drawn for ‘count’ number of redraws, then disabled.</p>
<p>The trigger mechanism only works if the <a href="VideoSwitcher" class="uri">VideoSwitcher</a> is set to high<br />
precision luminance display. It will emit a TTL pulse of 100 microseconds<br />
duration when the triggerline is drawn by your display. Only one TTL<br />
trigger pulse per video refresh is possible.</p>
<p><a href="PsychVideoSwitcher" class="uri">PsychVideoSwitcher</a>(‘SetBackgroundLuminanceHint’, win, luminance);<br />
- Tell the driver the ‘luminance’ value of the background pixels of<br />
onscreen windows ‘win’. The driver will use this hint to optimize<br />
conversion of background pixels. This allows for a quite significant<br />
speedup if your stimulus only covers a fraction of the display area and<br />
the remaining area is just a uniform luminance background. This is only<br />
functional if you use the driver that uses the calibration LUT, not the<br />
simple driver.</p>
<p><a href="RGBImage" class="uri">RGBImage</a> = <a href="PsychVideoSwitcher" class="uri">PsychVideoSwitcher</a>(‘MapLuminanceToRGB’, lum, ratio [, trigger]);<br />
- Perform conversion of a luminance image into a <a href="RGBImage" class="uri">RGBImage</a>. This is a pure<br />
Matlab based implementation for graphics hardware that is not capable of<br />
supporting the imaging pipeline.</p>
<p>Inputs:<br />
lum: luminance <a href="(MxN)%20matrix%20with%20values%20from%200%20to%201">(MxN</a><br />
ratio: blue to red ratio of the video switcher<br />
trigger: when non-zero, a trigger will be sent in current frame<br />
trigger=1 or ‘top’, the first line of image<br />
trigger=2 or ‘auto’, the first line with non-zero image<br />
trigger=3 or ‘middle’, the middle line of image<br />
If you omit ratio, you should give it in this code<br />
Output: RGB image <a href="(MxNx3)%20matrix%20with%20values%20from%200%20to%20255">(MxNx3</a></p>
<p><a href="RGBImage" class="uri">RGBImage</a> = <a href="PsychVideoSwitcher" class="uri">PsychVideoSwitcher</a>(‘MapLuminanceToRGBCalibrated’, lum, ratio, lut [, trigger])<br />
- Perform conversion of a luminance image into a <a href="RGBImage" class="uri">RGBImage</a>. This is a pure<br />
Matlab based implementation for graphics hardware that is not capable of<br />
supporting the imaging pipeline.</p>
<p>Inputs:<br />
lum: luminance <a href="(MxN)%20matrix%20with%20values%20from%200%20to%201">(MxN</a><br />
ratio: blue to red ratio of the video switcher<br />
lut: The 257 slots calibrated luminance table as described below.<br />
trigger: when non-zero, a trigger will be sent in current frame<br />
trigger=1 or ‘top’, the first line of image<br />
trigger=2 or ‘auto’, the first line with non-zero image<br />
trigger=3 or ‘middle’, the middle line of image<br />
If you omit ratio, you should give it in this code<br />
Output: RGB image <a href="(MxNx3)%20matrix%20with%20values%20from%200%20to%20255">(MxNx3</a></p>
<p>Note: this runs slow when lum matrix is large. 200x200 can take 1 second.</p>
<p>This uses the calibrated luminance table saved in calibratedlum.mat.<br />
For detail, check the paper http://lobes.usc.edu/Journals/JNM03.pdf</p>
<h3 id="the-steps-to-get-the-table">The steps to get the table:</h3>
<ol type="1">
<li><p>Switch the video switcher to grayscale mode;</p></li>
<li><p>Set up the equipement to accurately measure screen luminance;<br />
you can use a photometer or data acquisition system;</p></li>
<li><p>Measure 257 luminance levels at RGB of [0 0 b] and [btrr 0 255],<br />
where b is 0:255, and btrr the blue to red ratio of switcher;</p></li>
<li><p>Store 257 luminance in a variable callum and normalize them:<br />
callum=callum/callum(257);</p></li>
<li><p>Save it to a configuration file. See the help for subfunction<br />
‘GetDefaultConfig’ below for how and where to store the calibration<br />
table.</p></li>
</ol>
<p>[btrr, lut] = <a href="PsychVideoSwitcher" class="uri">PsychVideoSwitcher</a>(‘GetDefaultConfig’, win);<br />
- Get default ‘btrr’ parameter and ‘lut’ lookup table from configuration<br />
files and return them. This function can be used by you to get switcher<br />
parameters for use with the Matlab conversion functions above. It will be<br />
automatically used by the imaging pipeline (by <a href="PsychImaging" class="uri">PsychImaging</a>() command) if<br />
you select <a href="VideoSwitcher" class="uri">VideoSwitcher</a> as an output device but don’t provide explicit<br />
settings for ‘btrr’ and/or ‘lut’.</p>
<p>Configuration files for the <a href="VideoSwitcher" class="uri">VideoSwitcher</a> should be stored in the folder<br />
whose path you get if you type mypath = <a href="PsychtoolboxConfigDir" class="uri">PsychtoolboxConfigDir</a>(‘VideoSwitcher’);</p>
<p>You can store a configuration file specific to a display screen<br />
‘screenid’ (with the numbering as in <a href="Screen" class="uri">Screen</a>(‘Screens’)). The file should<br />
have the name <a href="SettingsforScreen" class="uri">SettingsforScreen</a>_X.mat with X being the screen number,<br />
e.g., <a href="SettingsforScreen" class="uri">SettingsforScreen</a>_0.mat . This allows you to store per-display<br />
device settings. Alternatively you can store settings in a “global”<br />
config file named <a href="GlobalSettings" class="uri">GlobalSettings</a>.mat if they are not specific to the<br />
display. The stored mat file should contain up to two variables:</p>
<p>The variable ‘btrr’ should store the measured/calibrated BTRR<br />
Blue-To-Red-Ratio for yor switcher and display setup. This variable is<br />
mandatory.</p>
<p>The optional variable ‘lut’ would be a 257 elements double vector of<br />
luminance calibration data, as described in the help text immediately<br />
above the help for this subfunction (== help for<br />
‘MapLuminanceToRGBCalibrated’).</p>
<p>You would create such a file by typing, e.g.:<br />
btrr = 128;<br />
lut = the lookup table vector created by calibration…<br />
save ‘GlobalSettings.mat’ btrr lut</p>
<p>Internal helper functions for Psychtoolbox - Must not be called from<br />
normal user code!!</p>
<p>luttexid = <a href="PsychVideoSwitcher" class="uri">PsychVideoSwitcher</a>(‘GetLUTTexture’, win, lut, btrr, shader);<br />
- Convert blue-to-luminance calibration lookup table ‘lut’ into a lookup<br />
table texture for the imaging pipeline, set it up and return a texture<br />
handle ‘luttexid’ to it. ‘btrr’ is the required BTRR value. ‘shader’ is<br />
the GLSL shader handle of the output formatting shader used.</p>
<p><a href="PsychVideoSwitcher" class="uri">PsychVideoSwitcher</a>(win);<br />
- If ‘win’ is a numeric onscreen window handle, perform all operations to<br />
implement the green channel trigger functionality for onscreen window<br />
‘win’. This routine uses MOGL glXXX() functions to implement drawing of<br />
proper trigger pixel values to the green channel for trigger creation.</p>
<div class="code_header" style="text-align:right;">
<p><span style="float:left;">Path  </span> <span class="counter">Retrieve <a href=
  "https://raw.github.com/Psychtoolbox-3/Psychtoolbox-3/beta/Psychtoolbox/PsychGLImageProcessing/PsychVideoSwitcher.m">current version from GitHub</a> | View <a href=
  "https://github.com/Psychtoolbox-3/Psychtoolbox-3/commits/beta/Psychtoolbox/PsychGLImageProcessing/PsychVideoSwitcher.m">changelog</a></span></p>
</div>
<div class="code">
<p><code>Psychtoolbox/PsychGLImageProcessing/PsychVideoSwitcher.m</code></p>
</div>

<h2 id="psychtoolbox-psychdocumentation">[[Psychtoolbox]] › [[PsychDocumentation]]</h2>
<p><a href="ProceduralShadingAPI" class="uri">ProceduralShadingAPI</a> - Documentation useful for procedural shading:</p>
<h3 id="parameters-for-procedural-shading">Parameters for procedural shading:</h3>
<p>There are three ways to pass data to a procedural shader for drawing of<br />
parameterized textures or texture-like stimuli:</p>
<ol type="1">
<li><p>Texture data: If you create the procedural texture via<br />
<a href="Screen" class="uri">Screen</a>(‘MakeTexture’, …., shader); by attaching a GLSL shader to a<br />
texture matrix, then you can pass image data or other 2D data, e.g.,<br />
matrices with whatever data makes sense, e.g., precomputed lookup tables.<br />
The shader can access that matrices/images at arbitrary texel locations.<br />
This makes sense for static data - content that doesn’t change, so it can<br />
be encoded into the texture image matrix. Such textures or lookup tables<br />
can be large, but they consume a lot of memory and bandwith.</p></li>
<li><p>Infrequently changing parameters: Parameters that do change, but don’t<br />
change too often, e.g., change only once per trial or maybe once per<br />
stimulus frame, can be passed as uniforms to the shader via the<br />
glUniform() low-level <a href="OpenGL" class="uri">OpenGL</a> command. Uniforms values can be changed<br />
anytime on the fly, but changing them incurs some overhead, so doing it<br />
too often may significantly degrade stimulus drawing speed.</p></li>
<li><p>Frequently changing parameters: Parameters that do change once per<br />
drawn texture (per-gabor parameters for drawing a large number of gabor<br />
patches per image) can be passed as so called vertex attributes. These<br />
parameters are passed directly to the <a href="Screen" class="uri">Screen</a>(‘DrawTexture(s)’) and<br />
efficiently transferred to the hardware. However, the number of such<br />
attributes is limited to a small value. E.g., ATI Radeon X1600 allows for<br />
a maximum of 16 such attributes. To keep your code portable to a variety<br />
of graphics hardware, you should use this option sparingly.</p></li>
</ol>
<p>The following vertex attributes are acessible from within a vertex<br />
shader:</p>
<p>Vertex attributes and their meaning, sorted by corresponding<br />
<a href="Screen" class="uri">Screen</a>(‘DrawTexture(s)’) parameters:</p>
<h3 id="srcrect">‘srcRect’:</h3>
<p>vec4 gl_TexCoord : (x,y,z,w) location of the corner(s) of the source<br />
texture to be drawn by <a href="Screen" class="uri">Screen</a>(‘DrawTexture(s)’) before rotation or scaling<br />
transforms (ie. before TEXTURE_MATRIX). Depending on the current vertex,<br />
the (x,y) components encode either the top-left, top-right, bottom-left or<br />
bottom-right position as given by the ‘srcRect’ parameter. The (z,w)<br />
components are currently unused, default to (0,1).</p>
<p>attribute vec4 srcRect : The ‘srcRect’ parameter as passed to the<br />
‘DrawTexture’ command: srcRect.xyzw = [left top right bottom].</p>
<h3 id="dstrect">‘dstRect’:</h3>
<p>vec4 gl_Vertex : (x,y,z,w) location of the corner(s) of the “textured” quad<br />
to be drawn by <a href="Screen" class="uri">Screen</a>(‘DrawTexture(s)’) before rotation or scaling<br />
transforms (ie. before MODELVIEW_MATRIX). Depending on the current vertex,<br />
the (x,y) components encode either the top-left, top-right, bottom-left or<br />
bottom-right position as given by the ‘dstRect’ parameter. The (z,w)<br />
components are currently unused, default to (1,1).</p>
<p>attribute vec4 dstRect : The ‘dstRect’ parameter as passed to the<br />
‘DrawTexture’ command: dstRect.xyzw = [left top right bottom].</p>
<h3 id="size-of-the-texture">Size of the texture:</h3>
<p>attribute vec4 sizeAngleFilterMode : sizeAngleFilterMode.xy contains the<br />
width and height of the underlying texture or virtual texture in texels.</p>
<h3 id="rotationangle">‘rotationAngle’:</h3>
<p>attribute vec4 sizeAngleFilterMode : sizeAngleFilterMode.z contains the<br />
‘rotationAngle’ parameter in degrees (ie. 0-360).</p>
<p>‘filterMode’:<br />
attribute vec4 sizeAngleFilterMode : sizeAngleFilterMode.w contains the<br />
‘filterMode’ parameter.</p>
<h3 id="modulatecolor-or-globalalpha">‘modulateColor’ or ‘globalAlpha’:</h3>
<p>vec4 gl_Color : Contains the color as passed by the fixed function<br />
pipeline. These values may be clamped to the 0.0 - 1.0 range on some<br />
systems, e.g., <a href="MacOS" class="uri">MacOS</a>/X 10.4.x and earlier.</p>
<p>attribute vec4 modulateColor : Contains the color/alpha unclamped. This<br />
is the same as gl_Color, but guaranteed to be not clamped to the 0-1<br />
range on any system.</p>
<p>The .r .g and .b components contain either the RGB values of the<br />
‘modulateColor’ argument, or (1,1,1) if none specified. The .a component<br />
contains either the A alpha value of ‘modulateColor’ if specified, or the<br />
‘globalAlpha’ value if no ‘modulateColor’ is specified but ‘globalAlpha’,<br />
or 1.0 if neither ‘modulateColor’ nor ‘globalAlpha’ was set.</p>
<p>Please note that the “color” values are affected by the color range<br />
remapping as set by <a href="Screen" class="uri">Screen</a>(‘ColorRange’) if ‘modulateColor’ is specified.<br />
If one wants to use ‘modulateColor’ to pass generic (non-color kind)<br />
parameters, one should probably set the color range to 0.0-1.0 for<br />
consistent results.</p>
<h3 id="auxparameters">‘auxParameters’:</h3>
<p>attribute vec4 auxParameters0 : Contains the first four components of the<br />
‘auxParameters’ vector or matrix passed to ‘DrawTexture(s)’ if any. These<br />
values are passed as is without any conversion - a good way to pass<br />
additional parameters to a shader in an efficient way.</p>
<p>Further components of the ‘auxParameters’ matrix get assigned to:<br />
attribute vec4 auxParameters1<br />
attribute vec4 auxParameters2<br />
attribute vec4 auxParameters3<br />
attribute vec4 auxParameters4<br />
attribute vec4 auxParameters5<br />
attribute vec4 auxParameters6<br />
attribute vec4 auxParameters7</p>
<p>The current number of such parameters is limited by PTB to 8*4 = 32 floating<br />
point values, but old graphics hardware may have lower limits on the<br />
number of allowed parameters.</p>
<div class="code_header" style="text-align:right;">
<p><span style="float:left;">Path  </span> <span class="counter">Retrieve <a href=
  "https://raw.github.com/Psychtoolbox-3/Psychtoolbox-3/beta/Psychtoolbox/PsychDocumentation/ProceduralShadingAPI.m">current version from GitHub</a> | View <a href=
  "https://github.com/Psychtoolbox-3/Psychtoolbox-3/commits/beta/Psychtoolbox/PsychDocumentation/ProceduralShadingAPI.m">changelog</a></span></p>
</div>
<div class="code">
<p><code>Psychtoolbox/PsychDocumentation/ProceduralShadingAPI.m</code></p>
</div>

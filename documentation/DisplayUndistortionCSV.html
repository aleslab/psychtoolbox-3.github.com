<h2 id="psychtoolbox-psychglimageprocessing">[[Psychtoolbox]] › [[PsychGLImageProcessing]]</h2>
<p>scal = <a href="DisplayUndistortionCSV" class="uri">DisplayUndistortionCSV</a>(calibinfilename [, caliboutfilename][, screenid])</p>
<p>Geometric display calibration procedure for undistortion of distorted<br />
displays. Needs graphics hardware with basic support for the PTB imaging<br />
pipeline (see below).</p>
<p>Many display devices, e.g., video beamers and most CRT displays cause<br />
some amount of spatial distortion to your visual stimuli during display.<br />
Video projection onto curved screens will cause an especially large<br />
amount of distortion.</p>
<p>Psychtoolbox can “undistort” your visual stimuli for you: At stimulus<br />
onset time, PTB applies a geometric warping transformation to your<br />
stimulus which is meant to counteract or cancel out the geometric<br />
distortion caused by your display device. If both, PTB’s warp transform<br />
and the implicit distortion transform of the display match, your stimulus<br />
will show up undistorted on the display device.</p>
<h3 id="for-this-to-work-ptb-needs-two-things">For this to work, PTB needs two things:</h3>
<ol type="1">
<li><p>Recent graphics hardware with support for the PTB imaging pipeline:<br />
See our Wiki for recommendations. However, all ATI cards starting with<br />
Radeon 9500 and all <a href="NVidia" class="uri">NVidia</a> cards of type <a href="GeForce" class="uri">GeForce</a>-FX5200 and later, as<br />
well as the Intel-GMA 950 and later should be able to do it, although<br />
more recent cards will have a higher performance.</p></li>
<li><p>A calibration file that defines the warp transformation to apply. Your<br />
experiment script will load that file into <a href="Screen" class="uri">Screen</a>’s “warp engine” at the<br />
beginning of your experiment and <a href="Screen" class="uri">Screen</a>() will automatically apply that<br />
warping to each stimulus image before output.</p></li>
</ol>
<p><a href="DisplayUndistortionCSV" class="uri">DisplayUndistortionCSV</a> defines a continous mapping (x’, y’) = f(x, y)<br />
from uncorrected input pixel locations (x,y) in your stimulus image to<br />
output locations (x’, y’) on your display. This mapping is defined by a<br />
linear mesh of quadrilaterals, as read from the given input file. The<br />
file format is compatible with the Warp-API of NVidia’s proprietary<br />
graphics drivers for some high-end Quadro <a href="GPUs" class="uri">GPUs</a> on Windows-7 and later.</p>
<h1 id="how-to-use">How to use</h1>
<h3 id="execute-the-function-with-the-following-parameters">Execute the function with the following parameters:</h3>
<p><code>calibinfilename</code> is the path and filename of an existing calibration<br />
file. This must be a ASCII file with a one-line header, describing the<br />
meaning of the data columns, followed by at least 4 lines with numeric<br />
calibration data. Each line defines a data row, which has six columns,<br />
delimited with a semicolon ‘;’. The columns of a row have the following<br />
meaning: vx;vy;tx;ty;c;r</p>
<p>vx = Output mesh vertex x position.<br />
vy = Output mesh vertex y position.<br />
tx = Input framebuffer corresponding x position.<br />
ty = Input framebuffer corresponding y position.<br />
c = Column index of the vertex.<br />
r = Row index of the vertex.</p>
<p>Each row describes one vertex of a mesh of connected quadrilaterals<br />
(GL_QUADS). The mesh is basically a rectilinear grid, whose “grid line”<br />
intersections are the locations of the vertices. The mesh gets distorted<br />
by moving around those intersections, thereby forming the actual warp<br />
mesh.</p>
<p>Pixel color values at location (tx,ty) of the input framebuffer are<br />
projected to location (vx,vy) of the warped output framebuffer. Quads are<br />
defined by 4 vertices which define their corners. Pixel sampling and<br />
output locations inside quads are bilinearly interpolated for a smooth<br />
warp grid. The origin of the calibration coordinate system is the<br />
top-left framebuffer / screen corner (0,0), x-axis points to the right,<br />
y-axis points downwards. All coordinates are normalized to a unit square<br />
screen. The range 0.0 - 1.0 maps to the screen width or height (0.0 =<br />
Left or Top, 1.0 = Right or bottom) and is subject to rescaling for a<br />
specific displays real resolution. Values outside the 0-1 range are<br />
allowed. The corresponding mesh locations will be clipped to screen<br />
corners during warping.</p>
<p>The file format described here is the format expected by NVidia’s<br />
Warp-API, as implemented in some binary <a href="NVidia" class="uri">NVidia</a> graphics drivers for some<br />
high-end Quadro graphics cards on Windows-7 and later. This allows to<br />
reuse the file for both <a href="NVidia" class="uri">NVidia</a> proprietary distortion correction and for<br />
Psychtoolbox.</p>
<p><code>caliboutfilename</code> Name of the file to which calibration results should<br />
be stored. If no name is provided, the file will be stored inside the<br />
‘GeometryCalibration’ subfolder of your psychtoolbox configuration<br />
directory (path is <a href="PsychToolboxConfigDir" class="uri">PsychToolboxConfigDir</a>(‘GeometryCalibration’). The<br />
filename will contain the screenid of the display that was calibrated.</p>
<p><code>screenid</code> screen id of the target display for calibration. The parameter<br />
is optional, defaults to zero, and is only used to generate the default<br />
filename for the output file.</p>
<p>This script will print out a little snippet of code that you can paste<br />
and include into your experiment script - That will automatically load<br />
the calibration result file and apply the proper undistortion operation.</p>
<div class="code_header" style="text-align:right;">
<p><span style="float:left;">Path  </span> <span class="counter">Retrieve <a href=
  "https://raw.github.com/Psychtoolbox-3/Psychtoolbox-3/beta/Psychtoolbox/PsychGLImageProcessing/DisplayUndistortionCSV.m">current version from GitHub</a> | View <a href=
  "https://github.com/Psychtoolbox-3/Psychtoolbox-3/commits/beta/Psychtoolbox/PsychGLImageProcessing/DisplayUndistortionCSV.m">changelog</a></span></p>
</div>
<div class="code">
<p><code>Psychtoolbox/PsychGLImageProcessing/DisplayUndistortionCSV.m</code></p>
</div>

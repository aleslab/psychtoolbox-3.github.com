<h2 id="psychtoolbox-psychpriority">[[Psychtoolbox]] › [[PsychPriority]]</h2>
<p><a href="MachSetTimeConstraintPriority" class="uri">MachSetTimeConstraintPriority</a>(periodSecs,computationSecs, constraintSecs, preemptibleFlag)</p>
<p>Assign the main MATLAB thread “time constraint” status, giving it super<br />
priority over other threads on the system. A thread given “time<br />
constraint” status can not be preempted by other threads and cedes CPU<br />
time to them on its own terms.</p>
<p><a href="MachSetTimeConstraintPriority" class="uri">MachSetTimeConstraintPriority</a> guarantees that within any block of<br />
“periodSecs” consecutive seconds the MATLAB thread is granted at least<br />
computationSecs seconds of CPU time.</p>
<p>Use “constraintSecs” to specify how “computationSecs” of CPU time is<br />
distributed throughought the period “periodSecs”. If the CPU time<br />
specified by “computationSecs” were broken and spread throught the entire<br />
interval “periodSecs”, then the actual time to complete the<br />
calculationSecs of computation will be greater than computationSecs<br />
itself; computationSecs of CPU usage could require up to periodSecs to<br />
complete. Argument “constraintSecs” specifies a period in which<br />
computationSecs of CPU usage is guranteed to complete. Note that<br />
constraintSecs must be &gt;= computationSecs because computationSecs of CPU<br />
usage can not complete in less than computationSecs. The maximum latency<br />
from the start of a computation to the end is constraintSecs -<br />
computationSecs.</p>
<p>Setting the preemptibleFlag flag allows MATLAB to be interrupted subject<br />
to constraintConstraint.</p>
<p>Granting a thread “time constraint” priority status gives it unlimited<br />
and uninterruptable control of the CPU, regardless of the limits<br />
specified by arguments to <a href="MachSetTimeConstraintPriority" class="uri">MachSetTimeConstraintPriority</a>. If a thread<br />
exceeds the limits on CPU time usage as specfied by arguments to<br />
<a href="MachSetTimeConstraintPriority" class="uri">MachSetTimeConstraintPriority</a> then the Mach Kernel’s task scheduler will<br />
eventually notice a problem and revoke “time constraint” priority status.<br />
On a dual 1.2 <a href="GHz" class="uri">GHz</a> G4 running OS X 10.2 the Mach task scheduler demotes<br />
MATLAB to standard priority after 2.5 seconds of uninterrrupted loop<br />
execution at “time constraint” priority.</p>
<p>For your script to abide by CPU time usage limits set by arguments to<br />
<a href="MachSetTimeConstraintPriority" class="uri">MachSetTimeConstraintPriority</a> it is necessary that it limit its own use<br />
of CPU time by calling blocking functions which surrender CPU time to<br />
other applications. Use “<a href="BlockSecsMex" class="uri">BlockSecsMex</a>” to surrender a specified period<br />
of time or use Use <a href="Screen" class="uri">Screen</a>(‘<a href="Flip" class="uri">Flip</a>’) to surrender time until the next video<br />
blanking interval. MATLAB when idle at the command line will<br />
automatically block.</p>
<p><a href="MachSetTimeConstraintPriority" class="uri">MachSetTimeConstraintPriority</a> is primarily intended to be used with<br />
<a href="Screen" class="uri">Screen</a>(‘CopyWindow’) animations to avoid interruptions for periods long<br />
enough to cause your animation script to miss an entire video frame.<br />
For animations:<br />
periodSecs- should be set to the video frame period as obtained<br />
with 1/<a href="Screen" class="uri">Screen</a>(‘FrameRate’).</p>
<pre><code>  computationSecs- should exceed the maximum amount of time which  
  your  script requires to render any single video frame.   

  constraintSecs need only be greater than computationSecs and less  
  than or equal to  periodSecs, within those limits should not effect  
  performance.      </code></pre>
<p><a href="MachSetTimeConstraintPriority" class="uri">MachSetTimeConstraintPriority</a> should be called immediatly before the<br />
start of the animation loop. To restore standard priority status to<br />
MATLAB after the animation ends use “<a href="MachSetStandardPriority" class="uri">MachSetStandardPriority</a>”</p>
<p><a href="MachSetTimeConstraintPriority" class="uri">MachSetTimeConstraintPriority</a> converts time arguments specified in units<br />
of seconds to units of bus ticks and calls <a href="MachSetPriorityMex" class="uri">MachSetPriorityMex</a>.<br />
<a href="MachSetPriorityMex" class="uri">MachSetPriorityMex</a>, in turn, invokes the OS X call thread_policy_set with<br />
the THREAD_TIME_CONSTRAINT_POLICY constant. For more info on<br />
thread_policy_set see:<br />
Psychtoolbox3/Source/Common/<a href="MachPriorityMex" class="uri">MachPriorityMex</a>/<a href="MachGetPriorityMex" class="uri">MachGetPriorityMex</a>.c<br />
http://developer.apple.com/documentation/Darwin/Conceptual/<a href="KernelProgramming" class="uri">KernelProgramming</a>/scheduler/chapter_8_section_4.html<br />
/usr/include/mach/thread_policy.h</p>
<p>SEE ALSO: <a href="MachSetStandardPriority" class="uri">MachSetStandardPriority</a>, <a href="MachSetPriorityMex" class="uri">MachSetPriorityMex</a>, <a href="BlockSecsMex" class="uri">BlockSecsMex</a></p>
<h3 id="authors">AUTHORS:</h3>
<p>Allen Ingling awi Allen.Ingling@nyu.edu<br />
Mario Kleiner mk</p>
<h3 id="history">HISTORY:</h3>
<p>8/13/03 awi Wrote it.<br />
2/17/05 mk bug-fix: constraintSecs argument was ignored.<br />
4/6/05 awi Added Mario’s bug fix to Psychtoolbox.org master.<br />
4/6/05 awi Replaced “<a href="GetBusFrequencymex" class="uri">GetBusFrequencymex</a>” calls with “<a href="MachTimebase" class="uri">MachTimebase</a>”<br />
4/8/05 awi Changed “<a href="MachTimebase" class="uri">MachTimebase</a>” to “<a href="MachAbsoluteTimeClockFrequency" class="uri">MachAbsoluteTimeClockFrequency</a>”</p>
<div class="code_header" style="text-align:right;">
<p><span style="float:left;">Path  </span> <span class="counter">Retrieve <a href=
  "https://raw.github.com/Psychtoolbox-3/Psychtoolbox-3/beta/Psychtoolbox/PsychPriority/MachSetTimeConstraintPriority.m">current version from GitHub</a> | View <a href=
  "https://github.com/Psychtoolbox-3/Psychtoolbox-3/commits/beta/Psychtoolbox/PsychPriority/MachSetTimeConstraintPriority.m">changelog</a></span></p>
</div>
<div class="code">
<p><code>Psychtoolbox/PsychPriority/MachSetTimeConstraintPriority.m</code></p>
</div>

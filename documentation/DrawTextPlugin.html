<h2 id="psychtoolbox-psychdocumentation">[[Psychtoolbox]] › [[PsychDocumentation]]</h2>
<p><a href="DrawTextPlugin" class="uri">DrawTextPlugin</a> – The plugin-based <a href="Screen" class="uri">Screen</a>(‘DrawText’) text renderer.</p>
<p>You may have arrived here because <a href="Screen" class="uri">Screen</a>() instructed you to go here<br />
after <a href="Screen" class="uri">Screen</a> failed to load the external text renderer plugin.</p>
<p>On all operating systems the functions <a href="Screen" class="uri">Screen</a>(‘DrawText’) and<br />
<a href="Screen" class="uri">Screen</a>(‘TextBounds’) try to use an external text rendering plugin for<br />
drawing and handling of high quality text. This allows for advanced text<br />
layout and formatting, high-quality anti-aliased rendering of text at<br />
arbitrary text sizes, support for modern fonts like <a href="TrueType" class="uri">TrueType</a>, and support<br />
for drawing of the full international Unicode character set. Its use across<br />
all operating systems also allows for (more) consistent text appearance on<br />
different systems. Differences between installed fonts on different operating<br />
systems can still cause slight differences in text appearance if you don’t<br />
manage this though.</p>
<p>Which text renderer should be used can be set via<br />
<a href="Screen" class="uri">Screen</a>(‘<a href="Preference" class="uri">Preference</a>’,‘TextRenderer’, type), and after a first call to<br />
<a href="Screen" class="uri">Screen</a>(‘DrawText’, …), type = <a href="Screen" class="uri">Screen</a>(‘<a href="Preference" class="uri">Preference</a>’,‘TextRenderer’) will<br />
report which ‘type’ of text renderer is actually used. A ‘type’ of 1 means<br />
that the plugin based renderer is used, a ‘type’ of 0 or -1 would mean the<br />
use of a less high quality fallback renderer, e.g., because loading the<br />
text rendering plugin failed.</p>
<p>If use of the drawtext plugin renderer fails then that likely means that<br />
some required 3rd party library is not installed, or of incompatible version.<br />
The plugin requires a working installation of the <a href="FreeType" class="uri">FreeType</a>-2 and<br />
<a href="FontConfig" class="uri">FontConfig</a> libraries on your operating system, ie., somewhere stored in<br />
a folder on the system library search path.</p>
<h1 id="how-to-get-those-required-3rd-party-libraries">How to get those required 3rd party libraries:</h1>
<h1 id="linux">Linux</h1>
<p>Nothing to do. On Linux these libraries are part of the default installation<br />
of any decent GNU/Linux distribution, so there usually isn’t any need for<br />
manual setup work on your part.</p>
<h1 id="osx">OSX</h1>
<p>On OSX with GNU/Octave, these are part of Octave, so you don’t need<br />
to do anything. If you use OSX with Matlab then you need to install<br />
the <a href="XQuartz" class="uri">XQuartz</a> X11 X-Server. See this link for how to get it:</p>
<p>https://support.apple.com/en-us/HT201341</p>
<p>Some recent Matlab versions, e.g., R2015a and R2015b will contain an<br />
outdated and incompatible version of libfreetype.6.dylib which will<br />
cause problems. Delete (or rename) that file, or move it out of the way.<br />
E.g., for R2015b you’d have to delete or rename this file:</p>
<p>/Applications/MATLAB_R2015b.app/bin/maci64/libfreetype.6.dylib</p>
<h1 id="windows">Windows</h1>
<p>On MS-Windows with GNU/Octave the libraries are bundled with Octave,<br />
no need for you to do anything.</p>
<p>On MS-Windows with Matlab you will need to install the [<a href="GStreamer" class="uri">GStreamer</a>][(GStreamer)]((GStreamer)) multi-<br />
media framework - see “help [<a href="GStreamer" class="uri">GStreamer</a>][(GStreamer)]((GStreamer))” for installation instructions -<br />
otherwise Psychtoolbox will use the old lower quality GDI text renderer<br />
instead.</p>
<p>If your version of Matlab bundles an outdated libfreetype.dll, as may be<br />
the case with at least R2015a and later, you may need to get rid of that as<br />
well, just as on OSX (see above). The file to delete or rename would likely<br />
be found in (e.g., for R2015b):<br />
C:Files2015b64 under a name like libfreetype.dll,<br />
or a similar name containing “freetype”.</p>
<h1 id="more-background-info-about-psychtoolboxs-standard-text-renderer">More background info about Psychtoolbox’s standard text renderer:</h1>
<p>On OSX one can still select Apple’s <a href="CoreText" class="uri">CoreText</a> text renderer via the command<br />
<a href="Screen" class="uri">Screen</a>(‘<a href="Preference" class="uri">Preference</a>’,‘TextRenderer’, 0); although Apples text renderer is<br />
inferior in essentially any aspect. Apples <a href="CoreText" class="uri">CoreText</a> renderer would also<br />
get automatically selected if the plugin renderer would not work for some<br />
reason. On MS-Windows one can still select the legacy MS-Windows GDI text<br />
renderer via <a href="Screen" class="uri">Screen</a>(‘<a href="Preference" class="uri">Preference</a>’,‘TextRenderer’, 0). This renderer provides<br />
lower quality anti-aliasing, less accurate computation of text bounding boxes<br />
via <a href="Screen" class="uri">Screen</a>(‘TextBounds’), and less accurate text positioning, as well as a<br />
lower text drawing speed. Additionally this legacy GDI text renderer has<br />
problems on <a href="HiDPI" class="uri">HiDPI</a> “Retina” displays and can misrender text in both size and<br />
appearance.</p>
<p>The text renderer plugin implements a high-speed renderer based on a<br />
combination of multiple free software libraries for text rendering and<br />
text handling:</p>
<p>* OGLFT (http://oglft.sourceforge.net/) the <a href="OpenGL" class="uri">OpenGL</a>-<a href="FreeType" class="uri">FreeType</a> library.<br />
* The <a href="FreeType" class="uri">FreeType</a>-2 (http://freetype.sourceforge.net/) library.<br />
* The <a href="FontConfig" class="uri">FontConfig</a> (http://www.fontconfig.org) library.</p>
<p>The <a href="FontConfig" class="uri">FontConfig</a> library is used to find the optimal font and font<br />
settings, given a specific font specification by your user code, a process<br />
known as “font matching”. <a href="FontConfig" class="uri">FontConfig</a> internally uses the <a href="FreeType" class="uri">FreeType</a>-2<br />
library to handle the font files on your system and to gather all needed<br />
information for the matching process.</p>
<p>After a font and settings have been selected, <a href="FreeType" class="uri">FreeType</a>-2 is used to load<br />
the font and convert it into high-quality character glyphs, then the<br />
OGLFT library is used to convert these glyphs into a format optimized for<br />
fast drawing with <a href="OpenGL" class="uri">OpenGL</a>. OGLFT also performs caching of glyphs, text<br />
layout, measurement of text dimensions and bounding boxes and the actual<br />
drawing of the text.</p>
<p>Our actual plugin coordinates all these operations and communicates with<br />
<a href="Screen" class="uri">Screen</a>().</p>
<p>The source code of the plugin can be found in the Psychtoolbox source<br />
tree under <a href="PsychSourceGL" class="uri">PsychSourceGL</a>/Cohorts/<a href="FTGLTextRenderer" class="uri">FTGLTextRenderer</a>/</p>
<p>The plugins themselves are stored in the<br />
Psychtoolbox/<a href="PsychBasic" class="uri">PsychBasic</a>/<a href="PsychPlugins" class="uri">PsychPlugins</a> folder of your Psychtoolbox<br />
installation. This is where <a href="Screen" class="uri">Screen</a>() expects to find the plugins for<br />
dynamic loading.</p>
<div class="code_header" style="text-align:right;">
<p><span style="float:left;">Path  </span> <span class="counter">Retrieve <a href=
  "https://raw.github.com/Psychtoolbox-3/Psychtoolbox-3/beta/Psychtoolbox/PsychDocumentation/DrawTextPlugin.m">current version from GitHub</a> | View <a href=
  "https://github.com/Psychtoolbox-3/Psychtoolbox-3/commits/beta/Psychtoolbox/PsychDocumentation/DrawTextPlugin.m">changelog</a></span></p>
</div>
<div class="code">
<p><code>Psychtoolbox/PsychDocumentation/DrawTextPlugin.m</code></p>
</div>

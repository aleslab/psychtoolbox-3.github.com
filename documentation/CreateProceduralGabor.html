<h2 id="psychtoolbox-psychglimageprocessing">[[Psychtoolbox]] › [[PsychGLImageProcessing]]</h2>
<p>[gaborid, gaborrect] = <a href="CreateProceduralGabor" class="uri">CreateProceduralGabor</a>(windowPtr, width, height [, nonSymmetric=0][, backgroundColorOffset =(0,0,0,0)][, disableNorm=0][, contrastPreMultiplicator=1][, validModulationRange=[-2,2]])</p>
<p>Creates a procedural texture that allows to draw Gabor stimulus patches<br />
in a very fast and efficient manner on modern graphics hardware.</p>
<p>This works on GPU’s with support for the <a href="OpenGL" class="uri">OpenGL</a> shading language and<br />
vertex- and fragment shaders. See <a href="ProceduralGaborDemo" class="uri">ProceduralGaborDemo</a> and<br />
<a href="ProceduralGarboriumDemo" class="uri">ProceduralGarboriumDemo</a> for examples on how to use this function.<br />
<a href="ProceduralGaborDemo" class="uri">ProceduralGaborDemo</a> shows drawing of a single gabor and also allows to<br />
perform a speed benchmark and a correctness test to verify correct<br />
working and accuracy of this approach. <a href="ProceduralGarboriumDemo" class="uri">ProceduralGarboriumDemo</a> shows how<br />
to draw large numbers of gabor patches with different paramters in a very<br />
fast and efficient way.</p>
<h3 id="parameters-and-their-meaning">Parameters and their meaning:</h3>
<p>‘windowPtr’ A handle to the onscreen window.<br />
‘width’ x ‘height’ The maximum size (in pixels) of the gabor. More<br />
precise, the size of the mathematical support of the gabor. Providing too<br />
small values here would ‘cut off’ peripheral parts or your gabor. Too big<br />
values don’t hurt wrt. correctness or accuracy, they just hurt<br />
performance, ie. drawing speed. Use a reasonable size for your purpose.</p>
<p>‘nonSymmetric’ Optional, defaults to zero. A non-zero value means that<br />
you intend to draw gabors whose gaussian hull is not perfectly circular<br />
symmetric, but a more general ellipsoid. The generated procedural texture<br />
will honor an additional ‘spatial aspect ratio’ parameter, at the expense<br />
of a higher computational effort and therefore slower drawing speed.</p>
<p>‘backgroundColorOffset’ Optional, defaults to [0 0 0 0]. A RGBA offset<br />
color to add to the final RGBA colors of the drawn gabor, prior to<br />
drawing it.</p>
<p>‘disableNorm’ Optional, defaults to 0. If set to a value of 1, the<br />
special multiplicative normalization term normf = 1/(sqrt(2*pi) * sc)<br />
will not be applied to the computed gabor. By default (setting 0), it<br />
will be applied. This term seems to be a reasonable normalization of the<br />
total amplitude of the gabor, but it is not part of the standard<br />
definition of a gabor. Therefore we allow to disable this normalization.</p>
<p>‘contrastPreMultiplicator’ Optional, defaults to 1. This value is<br />
multiplied as a scaling factor to the requested contrast value.</p>
<p>‘validModulationRange’ Optional, defaults to [-2, +2]. The range of gabor<br />
modulation values to which the gabr is clamped. As this can vary only in<br />
the range -1 to +1, the default setting of -2 &lt;= x &lt;= +2 means to not apply<br />
any restriction/clamping. If you’d set it to, e.g., [0, 2] then you would not<br />
allow negative values in the output gabor patch, only the positive “half-wave”.<br />
This is important when adding colors to gabors, according to practitioners of<br />
the field.</p>
<h3 id="michelson-contrast">Michelson contrast:</h3>
<p>If you use the normalized 0-1 color range and select ‘modulateColor’ below<br />
as unit values, e.g., modulateColor = [1 1 1 0], and leave globalAlpha out<br />
or set it to its 1.0 default, then the following seems to apply:</p>
<p>If you set the ‘disableNorm’ parameter to 1 to disable the builtin normf<br />
normalization and then specify contrastPreMultiplicator = 0.5 then the<br />
per gabor ‘contrast’ value will correspond to what practitioners of the<br />
field usually understand to be the contrast value of a gabor. Specifically,<br />
assuming a 0.5 (=50%) gray background and a properly gamma corrected /<br />
linearized display, the ‘contrast’ value, as described below, that you<br />
pass to <a href="Screen" class="uri">Screen</a>(‘DrawTexture’,…) will then allow to directly specify<br />
Michelson contrast: ‘contrast’ = (Imax - Imin) / (Imin + Imax)<br />
of course assuming isolated, non-superimposing gabors, so the Michelson<br />
contrast corresponds to the maxima and minima of the gabor patch under<br />
a suitable phase shift, where the minimum or maximum of the patch lies<br />
in the center of the patch.</p>
<p>The function returns a procedural texture handle ‘gaborid’ that you can<br />
pass to the <a href="Screen" class="uri">Screen</a>(‘DrawTexture(s)’, windowPtr, gaborid, …) functions<br />
like any other texture handle. The ‘gaborrect’ is a rectangle which<br />
describes the size of the gabor support.</p>
<h3 id="a-typical-invocation-to-draw-a-single-gabor-patch-may-look-like-this">A typical invocation to draw a single gabor patch may look like this:</h3>
<p><a href="Screen" class="uri">Screen</a>(‘DrawTexture’, windowPtr, gaborid, [], dstRect, Angle, [], [],<br />
modulateColor, [], kPsychDontDoRotation, [phase+180, freq, sc,<br />
contrast, aspectratio, 0, 0, 0]);</p>
<p>Draws the gabor ‘gaborid’ into window ‘windowPtr’, at position ‘dstRect’,<br />
or in the center if ‘dstRect’ is set to []. Make sure ‘dstRect’ has the<br />
size of ‘gaborrect’ to avoid spatial distortions! You could do, e.g.,<br />
dstRect = <a href="OffsetRect" class="uri">OffsetRect</a>(gaborrect, xc, yc) to place the gabor centered at<br />
screen position (xc,yc).</p>
<p>The definition of the gabor mostly follows the definition of Wikipedia,<br />
but you can check the source code of <a href="ProceduralGaborDemo" class="uri">ProceduralGaborDemo</a> for a reference<br />
Matlab implementation which is exactly equivalent to what this routine<br />
does.</p>
<p>Wikipedia’s definition (better readable): http://en.wikipedia.org/wiki/Gabor_filter<br />
See http://groups.yahoo.com/group/psychtoolbox/message/9174 for<br />
Psychtoolbox forum message 9174 with an in-dephs discussion of this<br />
function.</p>
<p>‘Angle’ is the optional orientation angle in degrees (0-360), default is zero degrees.</p>
<p>‘modulateColor’ is the base color of the gabor patch - it defaults to<br />
white, ie. the gabor has only luminance, but no color. If you’d set it to<br />
[255 0 0] you’d get a reddish gabor.</p>
<p>‘phase’ is the phase of the gabors sine grating in degrees.</p>
<p>‘freq’ is its spatial frequency in cycles per pixel.</p>
<p>‘sc’ is the spatial constant of the gaussian hull function of the gabor, ie.<br />
the “sigma” value in the exponential function.</p>
<p>‘contrast’ is the amplitude of your gabor in intensity units - A factor<br />
that is multiplied to the evaluated gabor equation before converting the<br />
value into a color value. ‘contrast’ may be a bit of a misleading term<br />
here…</p>
<p>‘aspectratio’ Defines the aspect ratio of the hull of the gabor. This<br />
parameter is ignored if the ‘nonSymmetric’ flag hasn’t been set to 1 when<br />
calling the <a href="CreateProceduralGabor" class="uri">CreateProceduralGabor</a>() function.</p>
<p>Make sure to use the <a href="Screen" class="uri">Screen</a>(‘DrawTextures’, …); function properly,<br />
instead of the <a href="Screen" class="uri">Screen</a>(‘DrawTexture’, …); function, if you want to draw<br />
many different gabors simultaneously - this is much faster!</p>
<div class="code_header" style="text-align:right;">
<p><span style="float:left;">Path  </span> <span class="counter">Retrieve <a href=
  "https://raw.github.com/Psychtoolbox-3/Psychtoolbox-3/beta/Psychtoolbox/PsychGLImageProcessing/CreateProceduralGabor.m">current version from GitHub</a> | View <a href=
  "https://github.com/Psychtoolbox-3/Psychtoolbox-3/commits/beta/Psychtoolbox/PsychGLImageProcessing/CreateProceduralGabor.m">changelog</a></span></p>
</div>
<div class="code">
<p><code>Psychtoolbox/PsychGLImageProcessing/CreateProceduralGabor.m</code></p>
</div>
